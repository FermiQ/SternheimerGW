\documentclass[twocolumn,prb,showpacs,superscriptaddress]{revtex4}
\usepackage{graphicx}
\usepackage{amsmath}    % need for subequations

%
% warning: if you redefine \r you will have troubles with the angstrom,
% which is internally defined as \r{A}
%

\def\s1{\hspace{0.5cm}}
\def\s2{\hspace{1cm}}
\def\w{\omega}
\def\wp{\omega^\prime}
\def\wc{{\omega_{\rm C}}}
\def\>{\rangle}
\def\<{\langle}
\def\H{\hat{H}}
\def\P{\hat{P}_{\rm occ}}
\def\E{\varepsilon}
\def\vp{{v^\prime}}
\def\q{{\bf q}}
\def\s{\sigma}
\def\k{{\bf k}}
\def\qp{{\bf q^\prime}}
\def\G{{\bf G}}
\def\Gp{{\bf G^\prime}}
\def\rt{\tilde{r}}
\def\pt{\tilde{p}}
\def\r{{\bf r}}
\def\rp{{\bf r^\prime}}
\def\rpp{{\bf r^{\prime\prime}}}
\def\rppp{{\bf r^{\prime\prime\prime}}}
\def\mo{$\overline{1}$}
\def\mt{$\overline{2}$}

% -------
\usepackage{soul}
\usepackage{color}
\definecolor{yellow}{rgb}{1,1,0}
\definecolor{lightblue}{rgb}{0.6,0.6,0.9}
\sethlcolor{yellow}
% -------

\begin{document}

\title{GW method using density-functional perturbation theory}

\author{Feliciano Giustino}
\email{feliciano.giustino@materials.ox.ac.uk}
\affiliation{Department of Materials, University of Oxford, Parks Road, Oxford OX1 3PH, United Kingdom}
\affiliation{Department of Physics, University of California at Berkeley, 
Berkeley, California 94720, USA,
and Materials Sciences Division, Lawrence Berkeley National Laboratory, 
Berkeley, California 94720, USA}
\author{Marvin L. Cohen}
\author{Steven G. Louie}
\affiliation{Department of Physics, University of California at Berkeley, 
Berkeley, California 94720, USA,
and Materials Sciences Division, Lawrence Berkeley National Laboratory, 
Berkeley, California 94720, USA}
\date{\today}

\begin{abstract}
We propose a new approach to quasiparticle GW calculations which 
is based on density-functional perturbation theory and
does not require the computation of unoccupied electronic states. In our approach 
the screened Coulomb interaction
is evaluated by solving self-consistent linear-response Sternheimer equations,
and the noninteracting Green's function is evaluated by solving inhomogeneous 
linear systems. The frequency-dependence of the screened Coulomb interaction 
is explicitely taken into account by performing calculations along the imaginary
frequency axis and then by performing the analytic continuation to real frequencies
using Pad\'e approximants. As a proof of concept we implemented the proposed methodology
within the empirical pseudopotential formalism and we validated our implementation
for the prototypical test case of silicon. We crytically examin the advantages and
limitations of our method and describe promising future developments.
\end{abstract}

\pacs{71.15.-m, % Methods of electronic structure calculations
      71.15.Qe} % Excited states: methodology

\maketitle

\section{Introduction}

During the past two and a half decades the $GW$ method\cite{hedin1,hl86}
for the study of electron quasiparticle excitations
scored a number of successes and witnessed a significant growth of interest
within the computational electronic structure community.
The $GW$ method is currently being used for predicting electron quasi-particle
excitation spectra as well as optical spectra in a variety of materials
ranging from bulk solids to nanostructures and organic systems. The
$GW$ method is also of widespread use as a starting point for Bethe-Salpeter calculations
of two-particle neutral excitations.\cite{onida,rolfing,reining-review}
Current implementations find many diverse applications,
including among others the simulation of the optical response of nanostructures,\cite{catalin} quantum transport in nanoscale
junctions,\cite{rubio} pump-probe spectroscopy,\cite{catalin-lw} angle-resolved photoemission
spectroscopy,\cite{cheolhwan} and strongly-correlated systems.\cite{bruneval-oxide}

Current trends in the development of improved computational approaches for
quasiparticle excitations based on the $GW$ method include the refinement
of the initial guess for the non-interacting Green's function and for the
polarization operator,\cite{rinke,schilfegarde}
the inclusion of approximate vertex corrections or higher-order self-energy
diagrams,\cite{york} and the description of the frequency-dependent
dielectric response beyond the original plasmon-pole approximation.\cite{spacetime,blochl}
Detailed reviews of past and current developments in $GW$ techniques can be
found in Refs.\ \onlinecite{hl,gunnarsson,reining-review,rinke}.

The majority of current implementations obtain the screened Coulomb interaction
$W$ and the non-interacting Green's function $G$ using a perturbative
expansion over the Kohn-Sham eigenstates (cf. Sec.\ \ref{sec.coulomb} below). 
Such expansion requires the calculation of both occupied and unoccupied electronic states,
as well as their associated optical matrix elements.\cite{hl86} A common bottleneck 
of this approach is that the convergence of the quasi-particle excitation energies
with the number 
of unoccupied states is rather slow.\cite{sohrab} This difficulty is particularly relevant
for the absolute values of the quasiparticle excitation energies.\cite{bruneval-gonze}
%
Several avenues have been explored so far in order to circumvent such bottleneck 
and to perform $GW$ calculations by employing occupied electronic states only,\cite{reining-sternheimer,umari1,umari2,gygi}
or only a limited number of unoccupied states.\cite{bruneval-gonze}


The main aim of the present work is to demonstrate the feasibility of $GW$ calculations
entirely based on density functional perturbation theory (DFPT).\cite{baroni.rmp}
In practice we adopt the principles of DFPT in order to determine (i)
the {\it frequency-dependent screened Coulomb interaction} 
by directly solving self-consistent linear response Sternheimer equations,
and (ii) the non-interacting Green's function by solving
inhomogeneous linear systems. The main advantage of the proposed method 
is that it does not requir the computation of unoccupied electronic states.
In addition, we demonstrate the possibility of fast evaluations of 
the frequency dependence of the screened Coulomb interaction
based on {\it multishift} linear-system solvers.\cite{frommer}
%
As a proof of concept we have implemented the method within
a planewaves empirical pseudopotential approach,\cite{cohen_berg} 
and validated it against previous work for the prototypical case of silicon.

The use of the Sternheimer equation for calculating the polarizability
in the random-phase approximation (RPA) or the inverse dielectric matrix 
have already been discussed in Refs.\ \onlinecite{fleszar-resta} and \onlinecite{kunc-tosatti},
respectively, 
within the context of supercell calculations. After the introduction 
of DFPT in the context of lattice-dynamical calculations,\cite{giannozzi} 
the authors of Ref.\ \onlinecite{reining-sternheimer} proposed the
use of the non self-consistent Sternheimer method for the calculation
of the dielectric matrix. The elimination of unoccupied electronic states
in the evaluation of the screened Coulomb interaction has also been 
proposed recently within the framework of a Wannier-like representation
of the polarization propagator, based on the Lanczos method.\cite{umari1,umari2}

The paper is organized as follows. In Sec.\ \ref{sec.theory} we describe
how the DFPT formalism can be adapted in order to perform $GW$ calculations.
In particular we outline the procedure to obtain the screened Coulomb
interaction in Sec.\ \ref{sec.coulomb}, the non-interacting Green's function
in Sec.\ \ref{sec.green}, and the $GW$ self-energy in Sec.\ \ref{sec.sigma}.
In Sec.\ \ref{sec.theory.g} we specialize to a planewave basis set representation
and we derive the key equations for the case of Bloch electrons.
Sections \ref{sec.coulomb.g}, \ref{sec.green.g}, \ref{sec.sigma.g}
parallel the corresponding sections in the general theory part, respectively.
In Sec.\ \ref{sec.scaling} we critically analyze the advantages 
and limitations of the present approach, with an emphasis on the
scaling of the calculations with system size. 
In Sec.\ \ref{sec.results} we report the results of our test calculations
for silicon and compare with the existing literature. In particular
we presents results for the direct and inverse dielectric matrix (Sec.\ \ref{sec.5a}),
for the accuracy of the analytic continuation using Pad\'e approximants
(Sec.\ \ref{sec.conv}), for the self-energy (Sec.\ \ref{sec.5c}), 
and for the spectral function (Sec.\ \ref{sec.5d}).
In Sec.\ \ref{sec.conclusions} we discuss possible
future developments of our method and we draw our conclusions.
The Appendices provide technical details on some numerical algorithms adopted
in this work, in particular the conditioning of the Sternheimer equations
(Appendix \ref{app.condition}),
the preconditioned complex biconjugate gradient method (Appendix \ref{app.cbcg}),
the analytic continuation using Pad\'e approximants (Appendix \ref{app.pade}),
and the use of multishift methods for the simultaneous calculation of 
the polarization at multiple frequencies (Appendix \ref{app.multishift}).

\section{General theory}\label{sec.theory}

\subsection{Screened Coulomb interaction}\label{sec.coulomb}

In this section we describe how to exploit density-functional
perturbation theory in order to calculate the screened Coulomb interaction
$W(\r,\rp;\w)$ (where $\r$, $\rp$ are the space variables and $\w$ is the
excitation frequency). We assume Rydberg atomic units throughout this manuscript. 
The Hedin's equation which defines the screened Coulomb 
interaction reads:\cite{hl}
%[Eq.\ (13.19b) of Ref.~\onlinecite{hl}] 
  \begin{eqnarray}\label{eq.w}
  W(\r,\rp;\w) & = & v(\r,\rp) + \int d\rpp \,W(\r,\rpp;\w)  \nonumber \\
   & \times & \int d\rppp P(\rpp,\rppp;\w) v(\rppp,\rp),
  \end{eqnarray}
where $v(\r,\rp)=e^2/|\r-\rp|$ denotes the bare Coulomb interaction and 
$P(\r,\rp;\w)$ the irreducible polarization propagator. 
Since Eq.\ (\ref{eq.w}) is a self-consistent Dyson equation for the
screened Coulomb interaction, it should be possible to solve it
recursively in the spirit of density-functional perturbation theory.
For simplicity, we here specialize to the case of the random-phase approximation (RPA)
for the polarization propagator. 
The generalization of this procedure to include exchange and correlation
effects can be performed without difficulties (cf.\ Sec.\ \ref{sec.vertex}).
Within the random-phase approximation the polarization propagator can be written as:\cite{hl}
% [Eq.\ (14.8) of Ref.~\onlinecite{hl}]:
  \begin{equation}\label{eq.p}
  P(\r,\rp;\w) = 2\sum_{n m} \frac{f_n-f_m}{\E_n-\E_m-\w} 
  \psi_n(\r)\psi_m^\star(\r)  \psi_n^\star(\rp)\psi_m(\rp),
  \end{equation}
where $\psi_n(\r)$ indicates an electronic eigenstate of the
single-particle Hamiltonian 
with energy eigenvalue $\E_n$ and occupation number $f_n$. 
In the following we assume that the $\psi_n(\r)$ are Kohn-Sham
eigenstates for definitness.
In Eq.\ (\ref{eq.p}) the summation indices $m$ and $n$ run over
both occupied and unoccupied electronic states, and the factor of 2 accounts for the
spin degeneracy.\cite{hl}
Although the expression for the RPA polarization Eq.~(\ref{eq.p})
has been derived for real frequencies in Ref.\ \onlinecite{hl}, it
is possible to continue the polarization throughout the complex 
plane by using Eq.~(\ref{eq.p}) as a definition outside of the real axis.
%In the absence of external magnetic fields we can exploit time-reversal 
%symmetry in Eq.\ (\ref{eq.p}) to obtain $P(\r,\rp;-\w)=P(\r,\rp;\w)$.
%As a consequence we have also $W(\r,\rp;-\w)=W(\r,\rp;\w)$ from Eq.\ (\ref{eq.w}).

Our goal is to rewrite Eqs.\ (\ref{eq.w}) and (\ref{eq.p})
in such a way to avoid explicit summations over the unoccupied electronic states.
For this purpose it is convenient to regard the screened interaction
$W(\r,\rp;\w)$ as a function of the 
second space variable $\rp$, whilst the first space variable 
$\r$ and the frequency $\w$ are kept as parameters: $\Delta V_{[\r,\w]}(\rp) = W(\r,\rp;\w)$.
If the system under consideration is subject to the perturbation
$\Delta V_{[\r,\w]}(\rp)$, then within the RPA the first-order variation 
of the single-particle density matrix $\Delta n_{[\r,\w]}$ reads
  \begin{equation}\label{eq.deltan}
  \Delta n_{[\r,\w]} = 2\sum_{v\s} \psi_v^\star  \Delta \psi^\s_{v[\r,\w]}.
  \end{equation}
In Eq.\ (\ref{eq.deltan}) the index $v$ stands for ``valence'' and runs
over the occupied electronic states only, the factor of 2 is for the spin degeneracy, 
and the superscript $\sigma=\pm$ refer to the positive and negative
frequency components of the induced charge.
The first-order variations of the occupied wavefunctions $\Delta \psi^\s_{v[\r,\w]}$
can be determined by solving the following two Sternheimer equations:
  \begin{equation}\label{eq.linsys.1}
  (\H-\E_v\pm\w) \Delta \psi^\pm_{v[\r,\w]}  = -(1-\P)  \Delta V_{[\r,\w]} \psi_v, 
  \end{equation}
where $\H$ is the effective single-particle Hamiltonian and 
$\P=\sum_v |\psi_v\rangle\langle\psi_v|$ is the projector
on the occupied states manifold. 
%Equations (\ref{eq.deltan}),(\ref{eq.linsys.1}) can be regarded as 
%the generalization to finite-frequency perturbations of the corresponding DFPT equations
%used for lattice-dynamical calculations.\cite{baroni.rmp} 
In the particular case of vanishing frequency ($\w=0$)
the $\sigma=\pm$ variations of the wavefunctions do coincide,
and the standard DFPT equations are recovered.
The screening Hartree potential associated with the induced charge 
$\Delta n_{[\r,\w]}$ is calculated as usual through
  \begin{equation}\label{eq.dhartree}
  \Delta V^{\rm H}_{[\r,\w]}(\rp) = \int d\rpp \Delta n_{[\r,\w]} (\rpp) \, v(\rpp,\rp),
  \end{equation}
and finally the screened Coulomb interaction in the RPA approximation is obtained as 
  \begin{equation}\label{eq.w.dfpt}
  W(\r,\rp;\w) = \Delta V_{[\r,\w]}(\rp) = v(\r,\rp) + \Delta V^{\rm H}_{[\r,\w]}(\rp).
  \end{equation}

It is tedious but otherwise straightforward to verify that 
Eqs.\ (\ref{eq.deltan})-(\ref{eq.w.dfpt}) are {\it equivalent} to the 
original Eqs.\ (\ref{eq.w})-(\ref{eq.p}).
The only assumptions made during our derivation are that 
time-reversal symmetry applies,
%, (ii) the off-diagonal components 
%of the screened interaction in the spin space
%can be neglected, 
and that the system under consideration presents a finite 
energy gap for electronic excitations. 
The assumption of time-reversal symmetry is not essential and is mainly used to
obtain a compact expression for the $\sigma=\pm$ wavefunction perturbations.
The assumption of finite energy gap can be relaxed using the extension
of DFPT to metallic systems developed in Ref.\ \onlinecite{degironcoli}. 

%Direct substitution into Eq.\ (\ref{eq.linsys.1}) shows that 
%$\Delta \psi^\s_{v[\r,-\w^\star]} = \Delta \psi_{v[\r,\w]}^{-\s\star}$,
%therefore $\Delta n_{[\r,-\w^\star]}=\Delta n^\star_{[\r,\w]}$ as expected
%from the properties of the RPA polarization propagator.

There is a simple and intuitive physical meaning associated with 
the calculation scheme outlined above. To see this
we consider an external {\it test charge} introduced in the system
at the point $\r$. This charge generates a bare Coulomb potential $v(\r,\rp)$,
and the system responds to such perturbation by generating the induced charge
$\Delta n_{[\r,\w]}(\rp)$ and the associated 
screening potential $\Delta V^{\rm H}_{[\r,\w]}(\rp)$.
The sum of the external perturbation $v(\r,\rp)$ and the screening
potential $\Delta V^{\rm H}_{[\r,\w]}(\rp)$ gives the screened Coulomb
interaction $W(\r,\rp;\w)$ at the point $\rp$ within the RPA approximation.

The linear systems Eq.\ (\ref{eq.linsys.1}) must be solved self-consistently.
For this purpose we begin by initializing the screened
interaction $W$ using the bare interaction $v$. 
We then calculate the linear variations of the wavefunctions $\Delta \psi_v^\sigma$.
Using the calculated linear variations we update the induced charge density $\Delta n$
and the associated screening potential $\Delta V^{\rm H}$. This allow us to
generate an improved estimate of the screened interaction $W$.
We repeat these steps until convergence of the screened Coulomb
interaction is achieved.
Equations (\ref{eq.deltan}),(\ref{eq.linsys.1}) can be regarded as
the generalization of the DFPT equations used for lattice-dynamical 
calculations\cite{baroni.rmp} to finite-frequency test-charge perturbations.



In practical calculations we solve Eq.\ (\ref{eq.linsys.1}) along the imaginary
frequency axis in order to avoid the null eigenvalues of the operator
$\H-\E_v\pm\w$, and then we perform the analytic continuation of 
the screened Coulomb interaction to real frequencies (cf.\ Appendix \ref{app.condition}).
In the special case of $\w=0$ it is convenient to modify the linear operator on the left-hand side of
Eq.\ (\ref{eq.linsys.1}) by adding the projector on the occupied manifold $\P$:
 \begin{equation} \label{eq.linsys.1b}
 (\H-\E_v+\alpha\P) \Delta \psi_{v[\r,0]}  = -(1-\P)  \Delta V_{[\r,0]} \psi_v,
  \end{equation}
with $\alpha$ set to twice the occupied bandwith. This extra term does not affect
the solutions $\Delta \psi_{v[\r,0]}$ which are linear combinations
of unoccupied electronic states. At the same time, the extra term
has the effect of shifting away from zero the null eigenvalues 
of the linear operator $\H-\E_v$ thereby making it non singular.
This strategy is common practice in DFPT implementations,\cite{baroni.rmp,espresso} and
is discussed in greater detail in Appendix \ref{app.condition}.

\subsubsection{Vertex correction}\label{sec.vertex}

Within the scheme outlined here it is rather straightforward to introduce
an approximate vertex correction to the $GW$ self-energy along the lines 
of Refs.\ \onlinecite{hl86,reining94}. This correction results from setting
the self-energy in the first iteration of Hedin's equations to the DFT
exchange-correlation (XC) potential, $\Sigma_0(\r,\rp;\w) = \delta(\r,\rp) V_{\rm xc}(\r)$.
Within the present scheme such correction is simply obtained by including
the variation of the exchange-correlation
potential in the self-consistent potential for the Sternheimer equations of Eq.\ (\ref{eq.linsys.1}):
  \begin{equation}\label{eq.linsys.vertex}
  (\H-\E_v\pm\w) \Delta \psi^\pm_{v[\r,\w]}\!  = \!-(1-\P)\!  \Big[\Delta V_{[\r,\w]} + K_{\rm xc}\Delta n_{[\r,\w]}\Big] \! \psi_v,
  \end{equation}
$K_{\rm xc}=\delta V_{\rm xc}/\delta n$ being the functional derivative of the XC
potential with respect to the density. The screened Coulomb interaction $W$ is still
to be calculated through Eq.\ (\ref{eq.w.dfpt}). This approach has been referred to as
``$GW+K_{\rm xc}$'' approximation in Ref.\ \onlinecite{reining94} due to the inclusion of the XC contribution
in the screening of the test charge. 
That the inclusion of the XC term in the self-consistent
induced potential leads to the $GW+K_{\rm xc}$ approximation can easily be seen as follows.
We can combine Eqs.\ (\ref{eq.deltan}),(\ref{eq.linsys.vertex}) to yield
the induced charge density (we use symbolic operator notation for clarity):
 \begin{equation}
 \Delta n = v\,[1- P (v+K_{\rm xc})]^{-1}P .
 \end{equation}
Then, we can substitute this result in the definition of the screened Coulomb interaction
Eqs.\ (\ref{eq.dhartree}),(\ref{eq.w.dfpt}) to find
 \begin{equation}
 W = v \,\{ 1 + v [1-P(v+K_{\rm xc})]^{-1}P \}.
 \end{equation}
The last equation yields precisely the screened Coulomb interaction in the $GW+K_{\rm xc}$ approximation.\cite{hl86,reining94}
% (see pag. 8026, above Table I).
The difference between this approach and the
standard $GW$ approximation is that in this case the screening
charge is calculated for a {\it test-electron}, while in the $GW$ approximation
the screening is calculated for a {\it test-charge}.
It is worth pointing out that in standard implementations of DFPT the
XC term is already included in the induced self-consistent potential,\cite{baroni.rmp}
therefore the use of the $GW+K_{\rm xc}$ approximation would not require any additional
computational developments if the 
present approach was implemented on top of existing DFPT software.\cite{espresso}

\subsubsection{Non self-consistent calculation of the dielectric matrix}\label{sec.diel.nscf}

An alternative approach to the calculation of the screened Coulomb interaction
using DFPT consists in solving Eq.\ (\ref{eq.linsys.1}) non self-consistently.
For this purpose we can replace the self-consistent perturbation $\Delta V_{[\r,\w]}(\rp)$
in the right-hand side of Eq.\ (\ref{eq.linsys.1}) by the bare Coulomb potential
$v_{[\r]}(\rp)=v(\r,\rp)$ as follows:
  \begin{equation}\label{eq.linsys.1.nscf}
  (\H-\E_v\pm\w) \Delta \psi^{{\rm NS},\pm}_{v[\r,\w]}  = -(1-\P)  v_{[\r]} \psi_v, 
  \end{equation}
and we can solve this Sternheimer equation with the known-term on the right-hand side
kept fixed. By constructing the induced charge density $\Delta n^{\rm NS}_{[\r,\w]}$ as in Eq.\ (\ref{eq.deltan})
we then obtain the dielectric matrix $\epsilon(\r,\rp;\w)$:
  \begin{equation}\label{eq.diel}
  \epsilon(\r,\rp;\w) = \delta(\r,\rp) - \Delta n^{\rm NS}_{[\r,\w]}(\rp).
  \end{equation}
It is straightforward to check that this procedure correctly leads to the RPA
dielectric matrix.\cite{hl86-prb}
The difference between this approach and the self-consistent calculation described in
Sec.\ \ref{sec.coulomb} is that here we also need to invert the dielectric matrix obtained
through Eq.\ (\ref{eq.diel}) in order to calculate the screened Coulomb interaction.

This non self-consistent procedure was first proposed in Ref.\ \onlinecite{reining-sternheimer}.
One extra step that we make in the present work is to notice that Eq.\ (\ref{eq.linsys.1.nscf})
constitutes a {\it shifted} linear system, i.e.\ a system where the linear operator
$\H-\E_v\pm\w$ differs from the ``seed'' operator $\H-\E_v$ only by a constant shift $\pm\w I$ 
($I$ being the identity operator). 
In this case we can take
advantage of the {\it multishift} method of Ref.\ \onlinecite{frommer}
to determine $\Delta \psi^{{\rm NS},\pm}_{v[\r,\w]}$ for every frequency $\w$
at the price of one single calculation for the {\it seed} system $(\H-\E_v) \Delta \psi^{{\rm NS}}_{v[\r,0]}  = -(1-\P)  v_{[\r]} \psi_v$.
This procedure is extremely advantageous as it makes it possible to calculate the whole frequency-dependence 
by performing one single iterative minimization. 
The technical implementation of this procedure is described in Appendix \ref{app.multishift}.


\subsection{Green's function}\label{sec.green}

The calculation of the Green's function can efficiently be performed 
by adopting a strategy similar to the DFPT approach
described in Sec.\ \ref{sec.coulomb}.
We introduce the noninteracting Green's function following Ref.\ \onlinecite{hl}:
  \begin{equation}\label{eq.green.1}
  G(\r,\rp;\w) = \sum_n \frac{\psi_n(\r)\psi_n^\star(\rp)}{\w-\E_n-i\eta_n},
  \end{equation}
where the sum extends over occupied as well as unoccupied electronic states.
The real infinitesimal $\eta_n$ is positive ($\eta_n=\eta$) 
for occupied states and negative ($\eta_n=-\eta$) for unoccupied states.\cite{hl,hl86}
The factor of 2 for the spin degeneracy is not included
as only the states with the same spin couple when forming the 
matrix elements of the $GW$ self-energy.\cite{hl86}
We now split the sum in Eq.~(\ref{eq.green.1}) into occupied ($v$) and unoccupied ($c$) states:
  \begin{equation}\label{eq.green.2}
  G(\r,\rp;\w) = \sum_v \frac{\psi_v(\r)\psi_v^\star(\rp)}{\w-\E_v-i\eta}
  + \sum_c \frac{\psi_c(\r)\psi_c^\star(\rp)}{\w-\E_c+i\eta},
  \end{equation}
and we add and subtract $\sum_v \psi_v\psi_v^\star/(\w-\E_v+i\eta)$ to obtain:
  \begin{equation}\label{eq.green.split}
  G(\r,\rp;\w) = G^{\rm A}(\r,\rp;\w) + G^{\rm N}(\r,\rp;\w),
  \end{equation}
with
  \begin{eqnarray}\label{eq.green.split.2}
\!\!\!\!\!\!  G^{\rm A}(\r,\rp;\w) & =&  \sum_n \frac{\psi_n^\star(\r)\psi_n(\rp)}{\w-\E_n^-},  \\ 
\!\!\!\!\!\!  G^{\rm N}(\r,\rp;\w)  & = &  2\pi i \sum_v \delta(\w-\E_v) \psi_v^\star(\r)\psi_v(\rp). \label{eq.green.split.3} 
  \end{eqnarray}
Here we assumed once again time-reversal symmetry, we used the Lorentzian representation of the Dirac's delta function 
$\pi\delta(x)=\eta/(x^2+\eta^2)$ for small $\eta$, and we defined $\E_n^- = \E_n - i\eta$.
The $G^{\rm A}$ component of the Green's function is obviously analytic in the
upper half of the complex energy plane as its poles lie below the real axis.
The non-analytic component $G^{\rm N}$ vanishes
whenever the frequency $\w$ is above the chemical potential 
On the other hand, for frequencies $\w$
below the chemical potential, the non-analytic part introduces the poles associated with the occupied 
electronic states. 
The partitioning of Eqs.\ (\ref{eq.green.split.2}),
(\ref{eq.green.split.3}) closely reflects the analytic structure
of the non-interacting Green's function.
%relates to the fact that
%the Green's function is analytic only in the upper
%half of the complex plane for frequencies above the chemical potential, and only in the lower half
%of the complex plane for frequencies below the chemical potential.
A detailed discussion of this aspect can be found in Ref.\ \onlinecite{hl}.
The two components of the Green's function in Eq.\ (\ref{eq.green.split.2}) 
are associated with the Coulomb hole (COH) and the screened exchange (SEX) terms of the
self-energy, respectively:\cite{hl86} 
$\Sigma^{\rm COH} = G^{\rm A} W$  and $\Sigma^{\rm SEX} = G^{\rm N} W$.

The computation of the non-analytic component $G^{\rm N}$ of the
Green's function in Eq.\ (\ref{eq.green.split.3}) is straightforward 
once the occupied electronic eigenstates have been determined.
In order to calculate th analytic component $G^{\rm A}$ it is convenient to
proceed as in the case of the screened Coulomb interaction,
by regarding $G^{\rm A}(\r,\rp;\w)$ as a parametric
function of the the first space variable and of the frequency:
$G^{\rm A}_{[\r,\w]}(\rp) = G^{\rm A}(\r,\rp;\w)$.
If we apply the operator $\H-\w^+$ to both sides of Eq.\ (\ref{eq.green.split.2}),
with $\w^+=\w+i\eta$,
and we use the completeness relation $\delta_{[\r]}(\rp) = \delta(\r,\rp) = \sum_n \psi_n(\r)\psi_n^\star(\rp)$, then we find immediately:
  \begin{equation}\label{eq.green.3}
  (\H-\w^+) G^{\rm A}_{[\r,\w]} = -\, \delta_{[\r]}.
  \end{equation}
As expected, we can determine the analytic part of the Green's function
by directly solving a linear system. As Eq.\ (\ref{eq.green.3}) 
does not explicitely require unoccupied electronic states, this procedure mimics 
the DFPT approach for the screened Coulomb interaction outlined in Sec.\ \ref{sec.coulomb},
albeit without the self-consistency requirement.

The procedure described here is especially advantageous because Eq.\ (\ref{eq.green.3})
constitutes a {\it shifted} linear system as Eq.\ (\ref{eq.linsys.1.nscf}).
Also in this case we exploit the {\it multishift} method of Ref.\ \onlinecite{frommer}
to determine $G^{\rm A}_{[\r,\w]}$ for every frequency $\w$
at the computational cost of one single calculation for the {\it seed} system $\H G^{\rm A}_{[\r,0]} = -\, \delta_{[\r]}$
(cf.\ Appendix \ref{app.multishift}).

The presence of the infinitesimal $i\eta$ in $\w^+=\w+i\eta$ 
guarantees that the linear operator $\H-\w^+$ in Eq.\ (\ref{eq.green.3.g}) be 
never singular.
This operator can however become ill-conditioned, hence the use of appropriate
preconditioners may become necessary. We discuss this aspect 
in Appendix~\ref{app.condition}.

\subsection{Self-energy}\label{sec.sigma}

The electron self-energy in the $GW$ approximation reads:\cite{hl86}
  \begin{equation} \label{eq.sigma}
  \Sigma(\r,\rp;\w) = \frac{i}{2\pi} \! \int_{-\infty}^{+\infty} \!\!\!\!d\wp 
    G(\r,\rp,\w+\wp) W(\r,\rp,\wp) e^{-i\delta\wp},
  \end{equation}
where $\delta$ is a positive infinitesimal. 
At large frequencies the Green's function decays as $\w^{-1}$ and 
the screened Coulomb interaction tends to the frequency-independent
bare Coulomb interaction $v$. As a consequence, the integrand in Eq.\ (\ref{eq.sigma}) 
decays as $\w^{-1}$ and the integration requires some care.

It is convenient to split the self-energy into an exchange contribution 
$\Sigma^{\rm ex}=Gv$ and a Coulomb term $\Sigma^{\rm c}=G(W-v)$.\cite{blochl}
It is easy to check that the integrand in the Coulmb term decays as 
$\w^{-2}$ at large frequencies, therefore the integral is well behaved and the 
integration can be performed by using a numerical cutoff $|\wp|< \wc$ 
in Eq.\ (\ref{eq.sigma}).
A detailed analysis of the analytic properties of the Coulomb term
$\Sigma^{\rm c}(\w)$ shows that it must decay as $\w^{-1}$ 
at large frequencis, and that the use of the cutoff $\wc$ in the integration 
introduces an error of the order of $\w_{\rm p}/\wc$, where $\w_{\rm p}$ denotes
the characteristic plasmon frequency of the system.

In order to integrate the exchange term we observe that 
$\Sigma^{\rm ex}=G^{\rm A}v + G^{\rm N}v$
and that the poles of $G^{\rm A}$ lie in the lower half of the complex plane,
hence the integration of the term $G^{\rm A}v$ yields a vanishing contribution.
On the other hand, the integration of $G^{\rm N}v$ yields a constant (frequency-independent) term.
Had we truncated the integral along the real axis as proposed for the Coulomb term, 
the $\Sigma^{\rm ex}$ term would have acquired a spurious frequency dependence associated with
the semicircle closing the complex integration path.
In summary, we perform the frequency integration in Eq.\ (\ref{eq.sigma}) 
by evaluating numerically
the Coulomb term using an energy cutoff, and by integrating analitycally the exchange term:
  \begin{equation}
  \Sigma(\r,\rp;\w) = \Sigma^{\rm c}(\r,\rp;\w) + \Sigma^{\rm ex}(\r,\rp),
  \end{equation}
with
  \begin{equation}\label{eq.convolution}
 \Sigma^{\rm c}(\r,\rp\!;\w) \! = \!\! \frac{i}{2\pi} \!\!\int_{_{-\wc}}^{^\wc} \!\!\!\!\!\!\!d\wp 
 G(\r,\rp\!;\w+\wp) \!\Big[W(\r,\rp\!,\wp)-v(\r,\rp)\!\Big]\!,
  \end{equation}
%  \begin{eqnarray}
%  \!\!\!\! \Sigma^{\rm c}(\r,\rp;\w) = \frac{i}{2\pi} \! \int_{-\wc}^\wc \!\!& \!\!d\wp &
%    \!\!\! G(\r,\rp,\w+\wp) \nonumber \\ 
%  & \times \!\!& \!\!\!\! [W(\r,\rp,\wp)-v(\r,\rp)],
%  \end{eqnarray}
and
  \begin{equation}
  \Sigma^{\rm ex}(\r,\rp) = - \sum_v \psi_v^\star(\r)\psi_v(\rp) v(\r,\rp).
  \end{equation}


\section{Implementation in a basis of planewaves}\label{sec.theory.g}

We here describe our planewaves implementation of the scheme 
developed in Sec.\ \ref{sec.theory}. The choice of a planewaves representation
was motivated by the need of making contact with existing literature on delectric
matrices,\cite{cpm,hl86-prb,balde_tosa,baroni-resta} 
and by the availability of DFPT software for lattice-dynamical
calculations\cite{espresso} which was used as a reference througout the implementation.

We adopt the following conventions for the transformation from real to reciprocal space.
The wavefunctions transform as usual according to:
  \begin{equation}
  \psi_{n\k}(\rp)=\frac{1}{\sqrt{\Omega}}\sum_\Gp
  {\rm e}^{i(\k+\Gp)\cdot\rp} u_{n\k}(\Gp),
  \end{equation}
with $\Omega$ the volume of the unit cell and $\k$ the Bloch wavevector.
The bare Coulomb interaction transforms according to
  \begin{equation}
  v(\r,\rp) = \frac{1}{N_\q\Omega}  \sum_{\q\G} v(\q+\G)
  {\rm e}^{i(\q+\G)\cdot(\rp-\r)},
  \end{equation}
where $\q$ is also a Bloch wavevector and $N_\q$ is the number of such wavevectors
in our discrectized Brillouin zone. In the above equation we have 
$v(\q+\G) = 4\pi e^2/|\q+\G|^2$.
The latter expression for $v(\q+\G)$ is arrived at by replacing
the integration $\int d\r \exp(i\q\cdot\r)/|\r|$ over the crystal volume by 
an integration over the entire space. This choice corresponds to assuming that we
have a very large crystal or equivalently a very fine sampling of the Brillouin zone.
Had we performed the integration on a sphere
with a radius $R_{\rm c}$ defined by the crystal volume 
($4/3\pi R_{\rm c}^3 = N_\q \Omega$), then we would have obtained
  \begin{equation}
  v_{\rm t} (\q+\G) = \frac{4\pi e^2}{|\q+\G|^2} (1-\cos |\q+\G| R_{\rm c}),
  \end{equation}
which corresponds to the truncated Coulomb potential introduced in Ref.\ \onlinecite{alavi}.
We will come back to this aspect in Sec.\ \ref{sec.coulomb.g}.
The screened Coulomb interaction and the non interacting Green's function
transform according to
  \begin{equation}\label{eq.w.bloch}
  W(\r,\rp;\w) = \!\!\frac{1}{N_\q\Omega} \!\! \sum_{\q\G\Gp} 
  {\rm e}^{-i(\q+\G)\cdot\r}
  W_{\G\Gp}(\q;\w)
  {\rm e}^{i(\q+\Gp)\cdot\rp},
  \end{equation}
and
  \begin{equation}
  G (\r,\rp;\w) = \frac{1}{N_\k\Omega}  \sum_{\k\G\Gp} 
   {\rm e}^{-i(\k+\G)\cdot\r} 
   G_{\G\Gp}(\k;\w)
   {\rm e}^{i(\k+\Gp)\cdot\rp},
  \end{equation}
with similar expressions for $G^A$, $G^N$.
We note that the sign convention adopted here in the Fourier transforms
[e.g.\ ${\rm exp}(+i\q\cdot\rp)$ in the rhs of Eq.\ (\ref{eq.w.bloch})]
is necessary to obtain the compact expression Eq.\ (\ref{eq.deltan.bloch}) below
for the induced charge, and is opposite to the convention adopted in Ref.~\onlinecite{hl86}.
Before proceeding it is also convenient to introduce the ``right-sided'' inverse dielectric matrix
through
  \begin{equation}
  W(\r,\rp;\w) = \int d\rpp v(\r,\rpp) \, \epsilon^{-1}(\rpp,\rp;\w).
  \end{equation}
By adopting the same convention for the inverse dielectric matrix
as for the screened Coulomb interaction Eq.\ (\ref{eq.w.bloch})
the above equation can be rewritten as:
  \begin{equation}\label{eq.Wg}
  W_{\G\Gp}(\q;\w) = v(\q+\G)  \epsilon^{-1}_{\G\Gp}(\q;\w).
  \end{equation}

%\vspace{2cm}
%  \begin{equation}\label{eq.dv.bloch}
%  \Delta v_{[\q,\G,\w]}(\rp) = \sum_\Gp {\rm e}^{i\Gp\cdot\rp} W_{\G\Gp}(\q;\w)
%  \end{equation}

%
% only for coding purposes
%
%  \begin{equation}
%  V_{\rm xc}(\r)=\frac{1}{\Omega}\sum_\G
%  {\rm e}^{i\G\cdot\r} V_{\rm xc}(\G),
%  \end{equation}
%

\subsection{Screened Coulomb interaction}\label{sec.coulomb.g}

%%%%%%%% RIPARTI DA QUI @@@@@@@@@@@
In order to rewrite Eqs.\ (\ref{eq.deltan})-(\ref{eq.w.dfpt}) in
the Bloch representation and in reciprocal space we proceed as follows.
We first write the linear systems Eq.\ (\ref{eq.linsys.1})
by relabeling the wavefunctions $\psi_v$ as Bloch states $\psi_{v\k}$:
  \begin{equation}\label{eq.linsys.3}
  (\H-\E_{v\k}\pm\w) \Delta \psi^\pm_{v\k[\r,\w]}  = -(1-\P)  \Delta V_{[\r,\w]} \psi_{v\k}.
  \end{equation}
The linear variations of the wavefunctions can be expanded in terms
of Bloch waves as follows:
  \begin{equation}\label{eq123}
  \Delta \psi^\sigma_{v\k[\r,\w]} = \frac{1}{N_\q\Omega} \sum_{\q\G} \Delta u^\sigma_{v\k[\q,\G,\w]}
  {\rm e}^{i(\k+\q)\cdot\rp} {\rm e}^{-i(\q+\G)\cdot\r},
  \end{equation}
where $\Delta u^\sigma_{v\k[\q,\G,\w]}$ is cell-periodic in $\rp$.
From the linear variations of the wavefunctions we construct the
induced charge density using Eq.\ (\ref{eq.deltan}):
  \begin{equation}\label{eq.ch}
  \Delta n_{[\r,\w]} = \frac{2}{N_\k}\sum_{v\k\s} \psi_{v\k}^\star  \Delta \psi^\s_{v\k[\r,\w]}.
  \end{equation}
Here the factor $N_\k$ takes into account the normalization of
the Bloch states in the unit cell [the 
wavefunctions $\psi_v$ in Eq.\ (\ref{eq.linsys.1}) which are normalized 
in the whole crystal].
%Note: all the integrals are performed over the volume of the crystal.
%The transformation of the variations are $\Delta \psi^\s_{v\k[\r,-\w^\star]}=\Delta \psi^{-\s\star}_{v,-\k[\r,\w]}$.
Next we expand the screened Coulomb interaction in terms
of Bloch waves: 
  \begin{equation}\label{eq.dv.bloch}
  \Delta V_{[\r,\w]} (\rp) = \frac{1}{N_\q\Omega}  \sum_{\q\G} \Delta v_{[\q,\G,\w]}(\rp) 
   {\rm e}^{-i(\q+\G)\cdot\r} {\rm e}^{i\q\cdot\rp}, 
  \end{equation}
where $\Delta v_{[\q,\G,\w]}$ is cell-periodic in $\rp$.
If we now replace Eqs.\ (\ref{eq.dv.bloch}) and (\ref{eq123}) into Eq.\ (\ref{eq.linsys.3})
we discover that the component $\Delta v_{[\q,\G,\w]}$ of the
perturbing potential corresponding to the Bloch wave ${\rm exp}(-i\q\cdot\r)$
couples only to the variations of the wavefunctions corresponding to
the Bloch wave ${\rm exp}[i(\k+\q)\cdot\rp]$.
As a result the linear system Eq.\ (\ref{eq.linsys.1}) becomes:
  \begin{equation}\label{eq.linsys.4}
  (\H_{\k+\q}-\E_{v\k}\pm\w) \Delta u^\pm_{v\k[\q,\G,\w]}  = -(1-\P^{\k+\q}) \Delta v_{[\q,\G,\w]} u_{v\k},
  \end{equation}
where $\H_\k= {\rm e}^{-i\k\cdot\r} \H {\rm e}^{i\k\cdot\r}$ and
$\P^\k=\sum_v | u_{v\k} \rangle \langle u_{v\k}|$.
The induced charge density associated with the Bloch wave ${\rm exp}(-i\q\cdot\r)$ 
now reads 
  \begin{equation} \label{eq.deltan.bloch}
  \Delta n_{[\q,\G,\w]} = \frac{2}{N_\k}\sum_{v\k\s} u_{v\k}^\star  \Delta u^\s_{v\k[\q,\G,\w]}.
  \end{equation}
This result is very similar to the case of standard DFPT.\cite{baroni.rmp} 
The main difference is that in the present case the translational invariance 
of the screened Coulomb interaction induces a coupling between the perturbation 
with Bloch wave ${\rm exp}(-i\q\cdot\r)$ in the variable $\r$ and its induced
response with Bloch wave ${\rm exp}(\,i\q\cdot\rp)$ in the variable $\rp$.
%
To conclude the derivation, we rewrite the screened Coulomb interaction 
Eq.\ (\ref{eq.w.dfpt}) after expanding the cell-periodic function 
$\Delta n_{[\q,\G,\w]}(\rp)$ in planewaves:
%$\Delta n_{[\q,\G,\w]}(\rp)=\sum_\Gp {\rm e}^{i\Gp\cdot\rp} \Delta n_{[\q,\G,\w]}(\Gp)$
  \begin{equation}\label{eq.w.deltan.g}
  W_{\G\Gp}(\q;\w) = [\delta_{\G\Gp} + \Delta n_{[\q,\G,\w]}(\Gp) ]v(\q+\Gp).
  \end{equation}

In practical calculations we proceed as follows: we first initialize the perturbation
in the linear systems using 
$\Delta v^{\rm bare}_{[\q,\G,\w]}(\rp) = v(\q+\G) \, {\rm exp}(\,i\G\cdot\rp)$.
The solution of the linear systems yields the change in the wavefunctions,
which are then used to construct the induced charge, the induced Hartree potential,
and the updated screened Coulomb interaction. We repeat this procedure by starting with
the updated screened Coulomb interaction until convergence is achieved.
At convergence the self-consistent perturbing potential yields
the screened Coulomb interaction $W_{\G\Gp}(\q;\w)$.
The calculation must be repeated for every perturbation, i.e.\ for
each set of parameters $[\q,\G,\w]$.
%
At the end of this procedure it is straightforward to obtain the inverse dielectric matrix 
$\epsilon^{-1}_{\G\Gp}(\q;\w)$ using Eqs.~(\ref{eq.w.deltan.g}) and 
(\ref{eq.Wg}). Alternatively, it is also possible to scale the initial
perturbation and use $\Delta v^{\rm bare}_{[\q,\G,\w]} = {\rm exp}(i\G\cdot\rp)$
to obtain the inverse dielectric matrix [in fact Eq.~(\ref{eq.linsys.4}) is a linear system].

The scheme here developed allows us to calculate one row (in $\Gp$) of the inverse 
dielectric matrix $\epsilon^{-1}_{\G\Gp}(\q;\w)$ by determining the linear response to the
perturbation ${\rm exp}[-i(\q+\G)\cdot\r]$. This idea has been discussed already
in Ref.\ \onlinecite{kunc-tosatti} in the framework of nonperturbative methods.

%We mention briefly that, for the purpose of numerical stability,
%in practical calculations it is convenient to modify the linear operator on the left-hand side of 
%Eq.\ (\ref{eq.linsys.4}) by adding a projector on the occupied manifold $\P^\k$:
% \begin{eqnarray} \label{eq.linsys.5}
%&  (\H_{\k+\q}-\E_{v\k}+\alpha\P^\k \pm\w) \Delta u^\pm_{v\k[\q,\G,\w]}  & = \nonumber \\
%&   -(1-\P^{\k+\q}) \Delta v_{[\q,\G,\w]} u_{v\k}, &
%  \end{eqnarray}
%with $\alpha$ set to twice the occupied bandwith. This extra term does not affect
%the solutions $\Delta u^\pm_{v\k[\q,\G,\w]}$ which are linear combinations
%of unoccupied electronic states. At the same time, the extra term
%has the effect of eliminating possible null eigenvalues of the linear operator
%$\H_{\k+\q}-\E_{v\k}\pm\w$ thereby making it non singular.
%This strategy is common practice in DFPT implementations,\cite{baroni.rmp,espresso} and 
%is discussed in greater detail in Appendix \ref{app.condition}.

\subsubsection{Singularities in the inverse dielectric matrix and the screened Coulomb interaction}

In order to avoid the singular behavior of the wings of the inverse dielectric matrix 
in the long wavelenght limit ($|\q|\!\rightarrow\!0$) it is convenient to work with
the symmetrized inverse dielectric matrix defined as follows:\cite{balde_tosa}
  \begin{equation}
  \tilde\epsilon^{-1}_{\G\Gp}(\q;\w) = \epsilon^{-1}_{\G\Gp}(\q;\w)  \frac{|\q+\Gp|}{|\q+\G\phantom{^\prime}|}.
  \end{equation}
Unlike its unsymmetrized counterpart $\epsilon^{-1}_{\G\Gp}(\q;\w)$,
the wings of $\tilde\epsilon^{-1}_{\G\Gp}(\q;\w)$ have finite limits 
at long wavelengths.
%Within this notation, the screened Coulomb interaction reads
%  \begin{equation}
%  W_{\G\Gp}(\q;\w) =   \frac{4\pi e^2}{|\q+\G||\q+\Gp|} \tilde\epsilon^{-1}_{\G\Gp}(\q;\w)
%  \end{equation}
%[I BELIEVE THAT THE LEFT MATRIX IS OBTAINED BY SWAPPING THE RIGHT MATRIX - CHECK THIS.
%PCM USES LEFT]
%
The screened Coulomb interaction of Eq.\ (\ref{eq.Wg}) is now rewritten in symmetrized form
as
  \begin{equation}\label{eq.Wg_symm}
  W_{\G\Gp}(\q;\w) = \frac{4\pi e^2}{|\q+\G||\q+\Gp|}  \tilde\epsilon^{-1}_{\G\Gp}(\q;\w).
  \end{equation}
While the symmetrized inverse dielectric matrix has finite limits at long wavelengths,
the screened Coulomb interaction still presents a divergence corresponding to the
long-range tail of the Coulomb potential in real space. This divergence requires special
handling when performing the Brillouin zone integration to calculate 
the $GW$ self-energy.\cite{hl86}
We here overcome this difficulty following the prescription of
Ref.~\onlinecite{alavi}. For this purpose we replace
the bare Coulomb potential $v(\r,\rp)$ by the truncated potential 
$v_{\rm t}(\r,\rp)=v(\r,\rp)[1-\Theta(|\r-\rp|-R_{\rm c})]$, 
$\Theta(x)$ being the Heaviside step function.
The truncation radius is defined as in Sec.\ \ref{sec.coulomb.g}. 
Using this truncated Coulomb potential, the final expression for the screened 
Coulomb interaction in reciprocal space becomes:
  \begin{equation}\label{eq.Wg_symm}
  W^{\rm t}_{\G\Gp}(\q;\w) = 4\pi e^2 \, \frac{1-\cos{R_{\rm c}|\q+\G|}}{|\q+\G||\q+\Gp|}\,
     \tilde\epsilon^{-1}_{\G\Gp}(\q;\w).
  \end{equation}
In the long-wavelenght limit $\q\!\rightarrow\!0$ the head ($\G=\Gp=0$) of the truncated
screened Coulomb interaction tends to
the finite limit 
$2\pi e^2 \, R_{\rm c}^2 \, \tilde\epsilon^{-1}_{00}(\q\!\rightarrow\!0;\w)$
and the singular behavior is removed.
Optimized truncation strategies have been developed for non-isotropic materials
and systems with reduced dimensionality.\cite{sohrab}

\subsection{Green's function}\label{sec.green.g}

We here specialize Eqs.\ (\ref{eq.green.1})-(\ref{eq.green.3}) to the case
of a planewaves basis and the Bloch representation.
We start by rewriting Eq.\ (\ref{eq.green.1}) after relabeling the electronic states
$\psi_n$ as Bloch states $\psi_{n\k}$ and taking into account the
normalization as in Sec.\ \ref{sec.coulomb.g}.
%  \begin{equation}\label{eq.green.1.g}
%  G(\r,\rp;\w) = \frac{1}{N_\k}\sum_{n\k} \frac{\psi_{n\k}(\r)\psi_{n\k}^\star(\rp)}{\w-\E_{n\k}-i\eta_{n\k}},
%  \end{equation}
Next we expand the Green's function in terms
of the Bloch waves ${\rm exp}[-i(\k+\G)\cdot\r]$ and ${\rm exp}(i\k\cdot\rp)$:
  \begin{equation}\label{eq.green.bloch}
  G^{\rm A}_{[\r,\w]} (\rp) = \frac{1}{N_\k\Omega}  \sum_{\k\G} g^{\rm A}_{[\k,\G,\w]}(\rp)
   {\rm e}^{-i(\k+\G)\cdot\r} {\rm e}^{i\k\cdot\rp},
  \end{equation}
with $g^{\rm A}_{[\k,\G,\w]}(\rp)$ cell-periodic in $\rp$. An analogous expansion
holds for the non-analytic component $G^{\rm N}$.
%By using the same convention for the wavefunctions 
%and the lattice-periodic part of the Green's function 
%$g^{\rm A,N}_{[\k,\G,\w]}(\rp)  = \sum_\Gp {\rm e}^{i(\k+\Gp)\cdot\rp} g^{\rm A,N}_{[\k,\G,\w]}(\Gp)$,
Equations (\ref{eq.green.split.2}),(\ref{eq.green.split.3}) are now rewritten as:
  \begin{equation}\label{eq.green.3.g}
   (\H_\k-\w^+)  g^{\rm A}_{[\k,\G,\w]}(\Gp)  =  -\,\delta_{\G\Gp},
  \end{equation}
  \begin{equation} \label{eq.green.4b.g}
  g^{\rm N}_{[\k,\G,\w]}(\Gp)  =  
  2\pi i \sum_v \delta(\w-\E_{v\k}) u^\star_{v\k}(\G)u_{v\k} (\Gp).
  \end{equation}
In deriving Eqs.\ (\ref{eq.green.3.g}),(\ref{eq.green.4b.g}) we made use once again
of time-reversal symmetry, yielding
$u^\star_{v\k}(\G) = u_{v,-\k}(-\G)$.
Similarly to the case of the screened Coulomb interaction, by solving the
linear system in Eq.\ (\ref{eq.green.3.g}) for a set of parameters $[\k,\G,\w]$ 
we obtain an entire row $\Gp$ of the analytic component of the
Green's function $g^{\rm A}_{[\k,\G,\w]}(\Gp)$.

\subsection{Self-energy}\label{sec.sigma.g}

The $GW$ self-energy in Eq.\ (\ref{eq.sigma}) is calculated in real space
after performing the Fourier transforms of $W_{\G\Gp}(\q;\w)$ and $G_{\G\Gp}(\k;\w)$.
The result is then transformed back in reciprocal space to obtain
$\Sigma_{\G\Gp}(\k;\w)$. The evaluation of the matrix elements of the
self-energy in the basis of Kohn-Sham eigenstates is performed in reciprocal space.
Since the planewave cutoff required to describe the inverse dielectric
matrix and the self-energy is typically much smaller than the cutoff used
in density-functional calculations,\cite{hl86} the procedure here described
does not require an excessive computational effort and accounts for only
a fraction of the total computation time.

\section{Scaling properties}\label{sec.scaling}

In this section we analyze the computational complexity of the algorithms
proposed in Sec.\ \ref{sec.theory.g}, by focusing on our planewave
implementation. Without loss of generality we consider a $\Gamma$ point sampling 
of the Brillouin zone and we leave aside the frequency-dependence of
the screened Coulomb interaction and of the non-interacting Green's function.
The Kohn-Sham electronic wavefunctions are expanded in a basis of plane waves
with a kinetic energy cutoff $E_{\rm cut}^{\rm wf}$, corresponding to
$N_\G^{\rm wf}$ plane waves and $N_\r^{\rm wf}$ grid points in real-space.
In the simplest case of norm-conserving pseudopotential approaches 
the electronic charge density will be described using a basis set with a cutoff
$E_{\rm cut}^{\rm den}=4E_{\rm cut}^{\rm wf}$, and the corresponding number of basis
functions will $N_\G^{\rm den}$, while the number of real-space grid points will be 
$N_\r^{\rm den}$. The screened Coulomb interaction, the Green's function,
and the self-energy will be described by a smaller cutoff $E_{\rm cut}^{\rm s}$,
with corresponding $N_\G^{\rm s}$ and $N_\r^{\rm s}$.

\subsubsection{Screened Coulomb interaction}\label{sec.coulomb.scaling}

Equation (\ref{eq.linsys.4}) needs to be solved for each one of the $N_\G^{\rm s}$ planewave perturbations,
and for each one of the $N_v$ occupied electronic states.
Each solution of Eq.\ (\ref{eq.linsys.4}) requires two cBiCG minimizations
(for $\pm\w$), and each cBiCG minimization consists of two CG sequences.
The most time-consuming operation in each CG step is the application of the Hamiltonian 
to the previous search direction, and in particular
the Fourier transform of the wavefunctions to real-space and back for evaluating
the product with the local potential. Fast-Fourier-transform (FFT)
algorithms allow us to perform these calculation in $N^{\rm den}_{\rm FFT} = 4 N_\r^{\rm den} {\rm log} N_\r^{\rm den}$ operations.\cite{frigo}
If in average the CG minimization requires $N_{\rm CG}$ steps
and the self-consistency loop requires $N_{\rm SCF}$ iterations,
then the total cost of the entire calculation corresponds to
   \begin{equation}\label{eq.scaling.1}
   N^{\rm DFPT}_{\rm flops} = 8 N_{\rm CG} N_{\rm SCF} N_\G^{\rm s}  N_v N^{\rm den}_{\rm FFT}
   \end{equation}
floating point operations.
As $N_\G^{\rm s}$, $N_v$, and $N_\r$ scale linearly with the size of the system
as measured by the number of atoms $N_{\rm at}$,
the overall scaling of this procedure is $N_{\rm at}^3 {\rm log} N_{\rm at}$.

For comparison it is useful to consider the scaling of standard $GW$ calculations
based on the expansion over unoccupied states.\cite{hl86} 
The calculation of the irreducible RPA polarization requires the evaluation of the 
optical matrix elements between each of the $N_v$ occupied states and each of the $N_c$ unoccupied states.
These matrix elements are typically computed by using Fourier transforms of $\psi_c^\star(\r)\psi_v(\r)$,
therefore this procedure requires essentially $N_v N_c$ Fourier transforms from real- to reciprocal-space.
Each Fourier transform is performed on the real-space grid for the density with $N_\r^{\rm den}$ grid points, 
therefore the total cost of the standard method is
   \begin{equation}\label{eq.scaling.2}
   N^{\rm HL86}_{\rm flops} = N_c  N_v N^{\rm den}_{\rm FFT}
   \end{equation}
floating point operations.
%The calculation of the empty states requires CG minimizations and most importantly the orthogonalization
%of the wavefunctions, which scales as $N_c^2 N_\G^{\rm wf}$. This is small as compared to 
%the calculation of the matrix elements.
Even in this case therefore the overall scaling is $N_{\rm at}^3 {\rm log} N_{\rm at}$.

In order to compare the prefactors in Eqs.\ (\ref{eq.scaling.1}) and (\ref{eq.scaling.2})
we now refer to the calculation of the dielectric matrix as described in Sec.\ \ref{sec.diel.nscf}
(as the standard method calculates the dielectric matrix and then performs a matrix inversion),
and set $N_{\rm SCF}=1$ in Eq.\ (\ref{eq.scaling.1}). In addition, we restrict ourselves to
the calculation of the static dielectric matrix as it is done in the standard approach.
In this case only one calculation of Eq.\ (\ref{eq.linsys.1}) is required instead of two for $\pm\w$, 
and also the two CG sequences of the cBiCG algorithm do coincide.
As a result a factor 4 drops out of the prefactor in Eq.\ (\ref{eq.scaling.1}).
If we assume for definitness a a perfectly well-conditioned linear system (with condition number $\kappa=1$),
and expressing the number of CG iterations through Eq.\ (\ref{eq.cg}),
the ratio between the complexity of the DFPT approach in a planewaves
implementation and the standard approach becomes
%   \begin{equation}
%   \frac{N^{\rm DFPT}_{\rm flops}}{N^{\rm HL86}_{\rm flops}} = \frac{2 N_{\rm CG} N_\G^{\rm s}}{N_c}.
%   \end{equation}
   \begin{equation}\label{eq.ratio.flops}
   \frac{N^{\rm DFPT}_{\rm flops}}{N^{\rm HL86}_{\rm flops}} = \frac{N_\G^{\rm s}}{N_c} {\rm log}\frac{2}{\varepsilon},
   \end{equation}
where $\varepsilon$ is the relative accuracy of the result.
As an example, for a relative accuracy of $\varepsilon=10^{-5}$ 
we find this ratio to be $\simeq 12 N_\G^{\rm s}/N_c$.
In the case of silicon, using a typical cutoff $E_{\rm cut}^{\rm s}=10$ Ry we obtain $N_\G^{\rm s}=137$, therefore
the DFPT approach becomes convenient when more than $\sim$1650 unoccupied states are used
in the standard approach.
This is rarely the case as most calculations reported to date use only a few hundreds of 
unoccupied electronic states.
Of course the accuracy of the standard sum-over-states expression is more difficult to
quantify in terms of the number of unoccupied states usded in the expansion, and probably
a convergence on 5 significant digits is not warrented by a few
hundreds electronic states. We can certainly state however that an implementation of DFPT-$GW$ 
based on planewaves is at least as expensive as the standard approach.

It should be noticed however, that our DFPT scheme (for the screened Coulomb interaction
and the Green's function taken together) has the advantage of providing
the whole self-energy $\Sigma(\r,\rp;\w)$, while the standard approach would 
only provide the matrix elements of the self-energy on a subset of states which is
typically of the order of $N_v$. Therefore, if we were to perform a comparison based on the
same amount of output information, we should use $N_c N_\G^{\rm s}$ in Eq.\ (\ref{eq.scaling.2})
instead of $N_c N_v$. In this case Eq.\ (\ref{eq.ratio.flops}) would change into
  \begin{equation}
  \frac{N^{\rm DFPT}_{\rm flops}}{N^{\rm HL86}_{\rm flops}} = \frac{N_v }{N_c}{\rm log} \frac{2}{\varepsilon},
  \end{equation}
and for $\varepsilon=10^{-5}$ we would have $N^{\rm DFPT}_{\rm flops}/N^{\rm HL86}_{\rm flops}\simeq 12 N_v/N_c$.
This clearly shows that, if the entire self-energy was needed (as opposed to a few matrix elements),
then our proposed DFPT approach woud be more convenient that the standard sum-over-states
approach.

The above analysis shows that the main bottlenecks of the DFPT-$GW$ method 
are (i) the Fourier transform for the application of the Hamiltonian and (ii) the large basis sets adopted.
In order to make the approach proposed here more efficient we could either
move to real-space methods where the application of the Hamiltonian scales linearly with system size,\cite{chelikowsky}
or reduce the size of the basis set by using local orbitals,\cite{siesta} or even a combination of both.
Fast evaluations of the operation $\hat{H}\psi$ in order-$N$ operations should 
make it feasible $GW$ calculations scaling with $N_{\rm at}^3$ and with a very favourable
prefactor.

\subsubsection{Green's function}\label{sec.green.scaling}

The complexity of the procedure for calculating the Green's function proposed
in Sec.\ \ref{sec.green} can be analyzed along the same
lines of Sec.\ \ref{sec.coulomb.scaling}. The main differences in this case are that (i) the linear system
Eq.\ (\ref{eq.green.3}) does not depend on the occupied states,
(ii) the calculation is non self-consistent, and (iii) the calculation is performed
for one single frequency $\w^+$ and the frequency-dependence is generated
through the multishift method. As a result, a factor $2 N_{\rm SCF} N_v$ drops out
of Eq.\ (\ref{eq.scaling.1}) and the computational cost of the Green's function
calculation is given by:
   \begin{equation}\label{eq.scaling.3}
   N^{\rm Gr}_{\rm flops} = 4 N_{\rm CG} N_\G^{\rm s} N^{\rm den}_{\rm FFT}.
   \end{equation}
The complexity of this procedure is significantly smaller than the complexity
of the DFPT algorithm for the screened Coulomb interaction. In particular, the
calculation of the Green's function scales as $N_{\rm at}^2 {\rm log} N_{\rm at}$.
It should be pointed out that the linear system Eq.\ (\ref{eq.green.3}) can become
ill-conditioned (when $\w^+$ is close to a Kohn-Sham eigenvalue) and in these cases
the number of CG iterations can be as high as 100-200.
This procedure for calculating the Green's function is advantageous
with respect to an expansion over empty states, as the orthogonalization
of the unoccupied states would require $\sim N_{\rm at}^3$ operations.

\subsubsection{Scaling of the self-energy calculation}\label{sec.sigma.scaling}

The self-energy is computed in real-space after obtaining $G(\r,\rp;\w)$ and $W(\r,\rp;\w)$ 
from $G(\G,\Gp;\w)$ and $W(\G,\Gp;\w)$, respectively, and then is tranformed back in reciprocal space.
The 6-dimensional FFT transforms require $(N_\G^{\rm s}+N_\r^{\rm s})N^{\rm s}_{\rm FFT}$
operations for each of the $N_\w$ frequencies of the screened Coulomb interaction,
having defined $N^{\rm s}_{\rm FFT}=4 N_\r^{\rm s} {\rm log} N_\r^{\rm s}$.
The computational cost of this calculation scales as $N_{\rm at}^2 {\rm log} N_{\rm at}$,
and is negligible with respect to the calculation of the screened
Coulomb interaction.

\section{Results}\label{sec.results}

In order to demonstrate our approach we have realized a prototype implementation
within the empirical pseudopotential method (EPM) of Ref.\ \onlinecite{cohen_berg},
and we have validated our implementation for the case of silicon.

\subsection{Dielectric matrices}\label{sec.5a}

Table \ref{tab.1} reports the inverse dielectric matrix calculated using
the self-consistent DFPT method described in Sec.~\ref{sec.theory.g}.
In all our calculations we used inverse dielectric matrices of size 59$\times$59, 
corresponding to a kinetic energy cutoff of 5 Ry for the screened Coulomb interaction.
For the purpose of comparison with Ref.\ \onlinecite{balde_tosa} 
we calculated the static ($\w=0$) and long-wavelenght limit ($\q \rightarrow 0$) of the inverse dielectric matrix
for the first few reciprocal lattice vectors $\G$. 
The authors of Ref.\ \onlinecite{balde_tosa} adopted the standard approach based 
on the expansion over the unoccupied electronic states of the dielectric matrix, 
and obtained the inverse dielectric matrix by performing matrix inversions.
In our calculations the matrix inversion is not needed as the self-consistent method 
in Sec.~\ref{sec.theory.g} is designed to yield the inverse dielectric matrix.
The excellent agreement between our calculation and Ref.~\onlinecite{balde_tosa}
supports the validity of our proposed approach.

Next we consider the wavevector dependence of the head of the
inverse dielectric matrix $\epsilon_{00}(\q,\w=0)$. We performed the
calculation by using the non self-consistent method described in
Sec.\ \ref{sec.diel.nscf} and we compared our results with Ref.\ \onlinecite{cohen.diel1}.
% 12-12-12 000 5Ry.
Figure \ref{fig1} shows that our calculations are in very good agreement with the results
of Ref.\ \onlinecite{cohen.diel1}. The slight differences between our results and those
of Ref.\ \onlinecite{cohen.diel1} at large wavevectors should be ascribed to the use of a limited 
number of empty states in the perturbative expansion over unoccupied states in the latter work.

Figure \ref{fig2} compares our results for the frequency dependence of the dielectric matrix
at long wavelenght with the data reported in Ref.\ \onlinecite{hl86}. 
We focused in particular on the cases illustrated in Fig.\ 3 of Ref.\ \onlinecite{hl86},
and calculated $\epsilon_{\G\Gp}(\q\rightarrow 0,\w)$ for $\G=\Gp=0$, $\G=\Gp=(1,1,1)$,
and $\G=(1,1,1)$, $\Gp=(2,0,0)$ in reciprocal lattice units.
Apart from some minor differences arising from the use of the expansion over unoccupied
states in Ref.\ \onlinecite{hl86}, even in this case the agreement between our DFPT calculation 
and those of Ref.\ \onlinecite{hl86} is very good throughout the entire frequency range
and for the head of the dielectric matrix as well as both diagonal and off-diagonal matrix elements.

\subsection{Pad\'e approximants and convergence}\label{sec.conv}

Figure \ref{fig3} shows the quality of the analytic continuation from the imaginary to
the real frequency using Pad\'e approximants. We found that this procedure based on 
Pad\'e approximants is generally very stable and requires minimal manual intervention.
Approximants of order 6 to 11 are able to reproduce both the location and the width of
the main plasmon-pole structures of the dielectric matrix. Head, wings, and body of the
dielectric matrix are described consistently (cf.\ Fig.\ \ref{fig3}). The singularity
corresponding to the absortpion onset in Fig.\ \ref{fig3}(a) is smoothed out by 
Pad\'e approximants of low order, but this does not pose a problem as this effect
is washed out when calculating the frequency convolution of the Green's function and 
the screened Coulomb interaction for the $GW$ self-energy.
% ARE U SURE ABOUT THIS?
The advantages of performing calculationg along the imaginary axis are that (i) the 
linear system Eq.\ (\ref{eq.linsys.1}) becomes progressively better conditioned
towards large imaginary frequencies, and (ii) a moderate Brillouin-zone sampling is
required to perform calculations along the imaginary axis (unlike the case of real-axis
calculations). As a result, the worst case scenario for the solution
of the linear system Eq.\ (\ref{eq.linsys.1}) corresponds to the static case $\w=0$.
These aspects are described in detail in Appendix \ref{app.condition}.

The typical number of non self-consistent iterations required to solve Eq.\ (\ref{eq.linsys.1})
for a fixed $\Delta V_{[\r,\w]}$ with a relative accuracy of $\varepsilon_{\rm NSCF}=10^{-10}$
using the cBiCG algorithm described in Appendix \ref{app.cbcg} is $N_{\rm CG}\simeq 21$
(using the preconditioner of Ref.\ \onlinecite{tpa}). This estimate has been obtained by averaging
over all the $\G,\Gp$ reciprocal lattice vectors, $\q$-vectors, and imaginary frequencies.
The typical number of self-consistent cycles required to obtain the screened Coulomb
interaction through Eq.\ (\ref{eq.linsys.1}) with a relative accuracy of $\varepsilon_{\rm SCF}=10^{-5}$ 
is $N_{\rm SCF}\simeq 5$.
%
% in practice the average condition number is 3 (quite good)
%
Charge-sloshing effects were atenuated by using the potential mixing method proposed in
 Ref.\ \onlinecite{johnson}, approriately modified to deal with complex potentials. 
For completeness it is convenient to report here the corresponding figures for
the calculation of the Green's function using Eq.\ (\ref{eq.green.3}). The average number
of non self-consistent iterations required to obtain the analytic part of the Green's
function is $N_{\rm G}\simeq 25$ when preconditioning is adopted (we used a slight modification
of the method of Ref.\ \onlinecite{tpa}). However, multishift minimizations as
described in Appendix \ref{app.multishift} do not allow for the use of preconditioning, and in the
latter case the number of iterations required to achieve convergence (within a relative
accuracy $\varepsilon_{\rm NSCF}=10^{-10}$) can be as high as $N_{\rm G}\simeq 100$. 

\subsection{Self-energy}\label{sec.5c}

Figures \ref{fig4} and \ref{fig5} show the real part ${\rm Re} \langle n\k| \Sigma|n\k\rangle$ 
and the imaginary part ${\rm Im} \langle n\k| \Sigma|n\k\rangle$ of the
$GW$ self-energy calculated for the first 8 silicon eigenstates at $\Gamma$
using our DFPT-$GW$ method within the EPM scheme. Our results are compared
with the calculations of of Ref.\ \onlinecite{blochl} performed within the LDA 
and the projector-augmented wave method.
We calculated the screened Coulomb interaction by using a uniform $6\times 6 \times 6$ grid 
to sample the Brillouin zone, and Pad\'e approximants of order 7 along the imaginary
frequency axis. The frequency integration of the Coulomb term $\Sigma^{\rm c}$ of the $GW$ 
self-energy in Eq.~(\ref{eq.convolution}) was performed by using a Coulomb cutoff 
$\wc = 100$ eV and a grid spacing of 0.5 eV. The Green's function was calculated
using an imaginary component $\eta = 0.3$ eV in Eq.\ (\ref{eq.green.3}).
Apart from some differences in the strenghts of the plasmaron damping,
the agreement between our calculated self-energy and the results of Ref.\ \onlinecite{blochl}
is rather good throughout the entire frequency range $\pm$100 eV.
This finding is quite surprising as we are comparing our empirical pseudopotential
calculations with low kinetic energy cutoff (5 Ry) with the {\it ab-initio} LDA
calculations including PAW core-reconstructions of Ref.\ \onlinecite{blochl}.
Such agreement probably reflects the ability of the EPM method to provide not only
a good description of the band structure of silicon, but also a reasonable
description of the electronic wavefunctions.

\subsection{Quasi-particle excitations and spectral function}\label{sec.5d}

Within the $GW$ method the values of quasi-particle excitation energies are typically 
calculated using first-order perturbation theory on the DFT eigenvalues.\cite{hl86}
The perturbation operator $\Delta \Sigma(\r,\rp;\w)$ corresponds to the difference between 
the $GW$ self-energy $\Sigma(\r,\rp;\w)$ and the DFT exchange and correlation potential $V^{\rm xc}(\r)$.
This approach is sensible because the complete quasi-particle equations
are similar to the ordinary Kohn-Sham equations if we replace the self-energy $\Sigma$
by DFT XC potential $V^{\rm xc}$.\cite{hl} 

Within the EPM scheme the total potential $V^{\rm EPM}$ acting on the electrons is specified,\cite{cohen_berg}
and the electronic charge density is not connected to such potential
through a self-consistent procedure.\cite{appelbaum}
This limitation makes it difficult to identify an XC contribution inside the empirical
pseudopotential. However, as the charge density obtained within the EPM method can be regarded 
as an approximation to the actual charge density,\cite{EPM-density}
it appears sensible to obtain the effective XC potential
as a functional of the EPM charge density
within the local density approximation.\cite{lda1,lda2}
This procedure is formally equivalent to assuming that the unscreened ionic pseudopotential
$V^{\rm ion}$ is given by $V^{\rm EPM} - V^{\rm Ha} - V^{\rm xc}$, where
the Hartree potential $V^{\rm Ha}$ and the XC potential $V^{\rm xc}$ are calculated using the EPM charge density.
%
This uncertainty on the XC potential renders the calculation of the quasi-particle
excitation energies somewhat arbitrary, therefore the results presented in the following
should be regarded as qualitative and are presented only with the purpose of demonstrating 
our DFPT-$GW$ methodology.

It is interesting to observe that, despite the above limitations, the expectation values of the
XC potential and of the echange term of the $GW$ self-energy calculated here are suprisingly
close to those reported in Ref.\ \onlinecite{hl86}. Indeed, for the valence band top 
$\Gamma_{25v}^\prime$ state and the conduction band bottom close to the $X_{1c}$ state
our calculated XC expectation values are -11.27 eV and -8.97 eV, respectively,
while Ref.\ \onlinecite{hl86} gives -11.80 eV and -9.61 eV for the corresponding states
at the DFT/LDA level. The agreemed is even better when comparing the expectation values
of the bare exchange part of the self-energy. In this case we find -12.43 eV and -5.07 eV
for the $\Gamma_{25v}^\prime$ state and the $X_{1c}$ state, respectively, to be compared
to the corresponding values of -12.54 eV and -5.28 eV from Ref.\ \onlinecite{hl86}.
These results provide an {\it a posteriori} justification to our choice of calculating
the XC potential using the EPM charge density and the LDA functional.

%QP renormalizations: VBT 0.78, CBB 0.68
Our calculated quasi-particle excitation energies for electronic states at the $\Gamma$ 
point and for the conduction band edge are reported in Table \ref{tab.2}
and compared to the results of Refs.\ \onlinecite{hl86,blochl}.
We find a good overall agreement between these different set of calculations,
which is rather suprising considered that we are comparing our DFPT-$GW$ scheme
within the EPM implementation with more sophisticated {\it ab-initio} calculations.

Figure \ref{fig6} shows the calculated quasi-particle spectral function 
  \begin{equation}\label{eq.specfun}
  \langle n\k| A|n\k\rangle = \frac{|{\rm Im} \Delta\Sigma_{n\k}|}
  {| \w-\E_{n\k} - {\rm Re}  \Delta\Sigma_{n\k} |^2 + | {\rm Im}  \Delta\Sigma_{n\k} |^2},
  \end{equation}
with $\Delta \Sigma_{n\k} = \langle n\k| \Sigma - V_{\rm xc} |n\k\rangle$.
We note that the previous expression assumes implicitely that the off-diagonal
matrix elements of the self-energy in the basis of the unperturbed
wavefunctions are negligible. While this approximation is not always justified,
we adopt Eq.\ (\ref{eq.specfun}) in order to be consistent with Ref.\ \onlinecite{blochl}.
In Fig.\ \ref{fig6} we observe a good overall agreement between our calculations and the
LDA/PAW results of Ref.\ \onlinecite{blochl}. This comparison demonstrates
once again the validity of our methodology.


% head: 777 000, body and wings: 666 000 (body and wings do not depend much on sampling)
% could not make the chadi-cohen 10-p mesh work, baroni-resta say that 8x8x8 is equiv to 10 chadi-cohen
% table: 1col, table* 2col
\begin{table}
\caption{\label{tab.1} Long-wavelenght limit of the static (symmetrized)
inverse dielectric matrix of silicon: $\tilde\epsilon^{-1}_{\G\Gp}(\q;\w)$ for
$\q=(0.01,0,0)$ and $\w=0$. We compare our calculations performed within
DFPT and the results obtained in Ref.\ \onlinecite{balde_tosa}
using the expansion over empty states and the inversion of the dielectric matrix.
For the calculations we sampled the Brillouin zone with 29 irreducible $\k$-points,
corresponding to a $8\times8\times8$ grid,\cite{balde_tosa,baroni-resta}
and a plane wave cutoff of 5 Ry.\cite{balde_tosa} Following Ref.\ \onlinecite{balde_tosa}
we employed the empirical pseudopotential parameters from Ref.\ \onlinecite{cohen_berg}.
\vspace{0.5cm}}
\begin{tabular}{c c c}
\hline
\hline
$\,\,\G$\phantom{ciao} $\,\Gp$   & Ref.\ \onlinecite{balde_tosa}  &  DFPT  \\
% & (Ref.\ \onlinecite{balde_tosa})    &    \\
\hline
    (0,0,0) (0,0,0)   & \phantom{-}0.083    &  \phantom{-}0.0866  \\
 (1,1,1)  (1,1,1)     &   \phantom{-}0.605  & \phantom{-}0.6055 \\
(\mo,1,1) (1,1,1)     &   \phantom{-}0.008  & \phantom{-}0.0076 \\
 (1,\mo,1) (\mo,1,1)  & \phantom{-}0.010    & \phantom{-}0.0102 \\
 (1,\mo,\mo) (\mo,1,1)& \phantom{-}0.045    & \phantom{-}0.0463 \\
 (2,0,0) (1,1,1)      &    -0.038           & -0.0382 \\
 (2,0,0) (\mo,1,1)    &    -0.005           & -0.0049 \\
 (2,0,0) (2,0,0)      &  \phantom{-}0.667   & \phantom{-}0.6671 \\
 (\mt,0,0) (2,0,0)    & \phantom{-}0.006    & \phantom{-}0.0063 \\
 (0,2,0) (2,0,0)      &  \phantom{-}0.016   & \phantom{-}0.0166 \\
\hline
\hline
\end{tabular}
\end{table}
 
\begin  {figure}
\begin  {center}
\includegraphics[width=7.5cm]{fig1.eps}
\end    {center}
\caption{\label{fig1}
        (Color online)
        Dielectric function of silicon calculated using the empirical pseudopotential method and the
        non self-consistent DFPT method of Sec.\ \ref{sec.diel.nscf}:
        calculated head of the static dielectric function as a function of wavevector $\epsilon_{00}(\q,\w=0)$ (blue solid line),
        and results from Ref.\ \onlinecite{cohen.diel1} (red dashed line). We used a planewave kinetic energy cutoff of 5 Ry
        and sampled the Brillouin zone thorough a uniform $8\times 8\times 8$ grid.
        }
\end    {figure}

\begin  {figure}
\begin  {center}
\includegraphics[width=6.5cm]{fig2.eps}
\end    {center}
\caption{\label{fig2}
        (Color online)
        Frequency-dependent dielectric matrix of silicon at long wavelenght ($\q=(0.01,0,0) \, 2\pi/a$).
        The calculations were performed using the empirical pseudopotential method of Ref.\ \onlinecite{cohen_berg} 
        and the non self-consistent DFPT method of Sec.\ \ref{sec.diel.nscf}.
        We used a planewave kinetic energy cutoff of 5 Ry and sampled the Brillouin zone thorough a uniform 
        $24\times 24\times 24$ grid. Such a dense Brillouin zone sampling is necessary to correctly describe
        the plasmon-pole singularities. In order to avoid null eigenvalues in the linear system Eq.\ (\ref{eq.linsys.1.nscf})
        we performed the calculations by including a small imaginary component (0.1~eV) in the frequency $\w$.
        The panels (a)-(c) correspond to the cases illustrated in Fig.\ 3 of Ref.\ \onlinecite{hl86}
        and show $\epsilon_{\G\Gp}(\q\rightarrow 0,\w)$ for (a) $\G=\Gp=0$, (b) $\G=\Gp=(1,1,1) 2\pi/a$,
        and (c) $\G=(1,1,1) 2\pi/a$, $\Gp=(2,0,0) 2\pi/a$.
        The (blue) solid lines are our calculations, the (red) dashed lines are from Ref.\ \onlinecite{hl86}.
        The real and imaginary parts of the dielectric matrix are indicated in each panel.
        We note that the scales on the vertical axes correspond to three different orders of magnitude.
        }
\end    {figure}

\begin  {figure}
\begin  {center}
\includegraphics[width=7.5cm]{fig3.eps}
\end    {center}
\caption{\label{fig3}
        (Color online)
        Real part of the long-wavelenght dielectric matrix of silicon as a function of frequency. 
        Panels (a) and (b) correspond to panels (a) and (b) of Fig.\ \ref{fig2}, respectively. The 
        technical details of the calculations are the same as those described in the caption of Fig.\ \ref{fig2}.
        Solid (blue) lines: dielectric matrices calculated directly along the real frequency axis,
        from  Fig.\ \ref{fig2}. Dotted, dashed, and dash-dotted (red) lines: dielectric matrices
        obtained from the analytic continuation on the real axis using Pad\'e approximants of order
        6, 11, and 26, respectively. The Pad\'e approximants were determined for dielectric
        matrices calculated along the imaginary frequency axis on a uniform frequency grid 
        in the range 0-50 eV (for instance, the 6-points approximant corresponds to the frequencies $0,10,\cdots,50$ eV).
        }
\end    {figure}


\begin  {figure}
\begin  {center}
\includegraphics[width=6cm]{fig4.eps}
\end    {center}
\caption{\label{fig4}
        (Color online)
        Real part ${\rm Re} \langle n\k| \Sigma(\r,\rp;\w)|n\k\rangle$   of the expectation value of the $GW$ self-energy for the first 
        8 silicon eigenstates at $\k=0$. The solid (blue) lines are our results using DFPT-$GW$ and the empirical
        pseudopotential method. The dashed (red) lines are from the first-principles calculation of Ref.\ \onlinecite{blochl} 
        using the LDA and the PAW method. Panels (a)-(d) correspond to the states
        $\Gamma^\prime_{2c}$ (Band 1), $\Gamma_{15c}$ (Bands 2-4), $\Gamma^\prime_{25v}$ (Bands 5-7), 
        and $\Gamma_{1v}$ (Band 8), respectively. The energy axis is aligned with the top of the valence band as calculated
        within the EPM (vertical lines).
        The horizontal dotted lines indicate the calculated bare exchange contribution to the self-energy ${\rm Re} \langle n\k| \Sigma^{\rm ex}(\r,\rp;\w)|n\k\rangle$.
        }
\end    {figure}

\begin  {figure}
\begin  {center}
\includegraphics[width=6cm]{fig5.eps}
\end    {center}
\caption{\label{fig5}
        (Color online)
        Imaginary part ${\rm Im} \langle n\k| \Sigma(\r,\rp;\w)|n\k\rangle$ of the expectation value of the $GW$ self-energy for the first
        8 silicon eigenstates at $\k=0$. The solid (blue) lines are our results using DFPT-$GW$ and the empirical
        pseudopotential method. The dashed (red) lines are from the first-principles calculation of Ref.\ \onlinecite{blochl}.
        Panels (a)-(d) correspond to the states $\Gamma^\prime_{2c}$, $\Gamma_{15c}$, $\Gamma^\prime_{25v}$, and $\Gamma_{1v}$, respectively.
        The energy axis is aligned with the top of the valence band as calculated within the EPM.
        }
\end    {figure}

\begin  {figure}
\begin  {center}
\includegraphics[width=6cm]{fig6.eps}
\end    {center}
\caption{\label{fig6}
        (Color online)
        Expectation values of the quasiparticle spectral function $\langle n\k| A(\r,\rp;\w)|n\k\rangle$.
        The solid (blue) lines are our results using DFPT-$GW$ and the EPM, the dashed (red) lines are from the first-principles 
        calculation of Ref.\ \onlinecite{blochl} using the LDA and the PAW method.
        The expectation values have been calculated within the diagonal approximation of Eq.\ (\ref{eq.specfun}).
        In each panel the sharp peak near the band extrema corresponds to a well-defined quasi-particle, while the two broad peaks
        corresponds to plasmarons, i.e.\ electrons or holes coupled to a cloud of real plasmons.\cite{hl}
        The suppression of one of the plasmaron peaks reflects the large imaginary parts of the self-energy in the
        corresponding panels of Fig.\ \ref{fig5}. We note the different vertical scale in panel (d).
        }
\end    {figure}

% table: 1col, table* 2col
\begin{table*}
\caption{\label{tab.2}
$GW$ quasi-particle excitation energies for the $\Gamma^\prime_{2c}$, $\Gamma_{15c}$, $\Gamma^\prime_{25v}$, $\Gamma_{1v}$
states of silicon, as well as for the conduction band bottom of silicon close to the $X_{1c}$ state.
We obtained the quasi-particle energies $E_{n\k}$ by solving the self-consistent equations
$E_{n\k} = \E_{n\k} + {\rm Re}  \Delta\Sigma_{n\k}(E_{n\k})$, with $\Delta \Sigma_{n\k} = \langle n\k| \Sigma - V_{\rm xc} |n\k\rangle$.
For completeness we also show the unperturbed eigenvalues calculated here within the EPM scheme,
and those of Ref.\ \onlinecite{blochl} within the DFT/LDA scheme for comparison.
It is interesting to observe that the value of the minimum band gap is not increased from
the EPM value of $0.82$ eV when applying the $GW$ correction. In absolute terms the $X_{1c}$ state shifts upwards by 0.41 eV upon 
the $GW$ correction, but this shift is compensated by the concurrent upward shift of the $\Gamma^\prime_{25v}$
state by 0.44 eV.
\vspace{0.5cm}}
\begin{tabular}{l r@{.}l  r@{.}l  r@{.}l r@{.}l r@{.}l c}
\hline
\hline
   & \multicolumn{4}{c}{\hspace{-0.6cm} EPM/LDA eigenvalues}  &
\multicolumn{7}{c}{Quasiparticle energies} \\
   & \multicolumn{2}{c}{Present}  & \multicolumn{2}{c}{Ref.\ \onlinecite{blochl}} & 
\multicolumn{2}{c}{\hspace{1cm}Present} & \multicolumn{2}{c}{\hspace{0.3cm} Ref.\ \onlinecite{hl86}} & \multicolumn{2}{c}{\hspace{0.3cm} Ref.\ \onlinecite{blochl}} &\hspace{1cm} Expt. \\
\hline
$\Gamma^\prime_{2c}$  &   3&89 & 3&23   & \hspace{1cm}  4&21 & \hspace{0.3cm}  4&08 &\hspace{0.3cm}   4&05 & \hspace{1cm}4.23$^{\rm a}$,4.1$^{\rm b}$\\
$\Gamma_{15c}$        &   3&42 & 2&54   & \hspace{1cm}  3&53 & \hspace{0.3cm}  3&35 &\hspace{0.3cm}   3&09 & \hspace{1cm}3.40$^{\rm a}$,3.05$^{\rm b}$\\
$\Gamma^\prime_{25v}$ &   0&00 & 0&00   & \hspace{1cm}  0&00 & \hspace{0.3cm}  0&00 &\hspace{0.3cm}   0&00 & \hspace{1cm}0\\
$\Gamma_{1v}$         & -12&62 & -11&97 & \hspace{1cm}-13&23 & \hspace{0.3cm}-12&04 &\hspace{0.3cm} -11&85 & \hspace{1cm}-12.5$\pm$0.6$^{\rm a}$\\
$X_{1c}$              &   0&82 & 0&55   & \hspace{1cm}  0&79 & \hspace{0.3cm}  1&29 &\hspace{0.3cm}   0&92 & \hspace{1cm} 1.17$^{\rm a}$\\
\hline
\hline
$^{\rm a}$ Ref.\ \onlinecite{r35}.
$^{\rm b}$ Ref.\ \onlinecite{r39}.
\end{tabular}
\end{table*}

\section{Conclusions and outlook}\label{sec.conclusions}

The results presented in Sec.\ \ref{sec.results} demonstrated the feasibility
of the DFPT approach to $GW$ calculations in the simple case of a prototype implementation
based on the empirical pseudopotential method. The extension of the present
methodology to {\it ab-initio} approaches based on norm-conserving\cite{ncpp}
or ultrasoft\cite{uspp} pseudopotentials should not pose and difficulties
as all the crucial issues in the calculation have already been addressed and 
solved in this work. 
%
The main advantage of the present methodology consists in the definitive
elimination of the unoccupied electronic states from the calculations of
{\it both} the screened Coulomb interaction and the non-interacting Green's
function. Another appealing aspect is that our methodology constitutes a
generalization to frequency-dependent perturbations of 
density-functional perturbation theory,\cite{baroni.rmp} a well
established technique with a long history of successes.

As discussed in Sec.\ \ref{sec.scaling} the present approach is comparable
in performance to standard\cite{hl86} $GW$ techniques.
The question remains on whether it is possible to make significant
improvements over the methodology proposed here {\it without sacrifying
the numerical accuracy}. Some simple tests show that the most time-consuming
step of the entire procedure is the application of the single-particle
Hamltonian $\H$ to a search direction $\psi$ in the Hilbert space spanned
by the wavefunction basis set during the self-consistent iterative solution 
of the linear systems Eq.\ (\ref{eq.linsys.1}). In order to accelerate
this operation there are probably three ways ahead: (i) the improvement of the
minimization algorithms adopted, (ii) the use of sparse representations of
the Hamiltonian, and (iii) the use of smaller basis sets. 

(i) The iterative solution of Eq.\ (\ref{eq.linsys.1}) is here performed
by first solving for $\Delta\psi_v^\pm$ at fixed $\Delta V$, and then 
by updating $\Delta V$ in the self-consistency cycle.
It should be possible, at least in principle, to combine these two
operations in a single minimization step. This could be achieved
for instance by using the variational formulation of density-functional
perturbation theory developed in Ref.\ \onlinecite{gonze-variational},
or by using simulated annealing techniques such as the Car-Parrinello 
method.\cite{carparrinello} Both of these approaches were developed
for Hermitian systems, hence appropriate generalizations
to non-Hermitian systems would be required to address Eq.\ (\ref{eq.linsys.1}).
As mentioned in Sec.\ \ref{sec.conv} the total number of cBiCG iterations
required to solve Eq.\ (\ref{eq.linsys.1}) is typically 
$N_{\rm CG} N_{\rm SCF}\sim 100$, therefore the variational formulation
of DFPT or the Car-Parrinello minimization would be convenient
if they resulted in a significant reduction of the number of iterations
over this figure.

(ii) Another possibility for improving the algorithm presented in this work
is to resort to a real-space representation of the kinetic energy operator
in the single-particle Hamiltonian. This can be achieved by
calculating the kinetic energy on a real-space mesh using finite-differences
formulas.\cite{chelikowsky} The main advantage of this approach would be
to have $GW$ calculations scaling with the cube of the system size
$N_{\rm at}^3$ instead of $N_{\rm at}^3 {\rm log} N_{\rm at}$.
However, in actual calculations the numerical prefactor associated with the scaling
could be unfavourable. Indeed, the fast Fourier transforms used in a planewaves
representation to calculate the product of the potential and the wavefunctions
require $2\cdot 34/9 N_\r^{\rm den} {\rm log} N_\r^{\rm den}$ floating point operations,
while the cost of the real-space calculation of the Laplacian operator
to sixth order is $37 N_\r^{\rm den}$
(for a supercell with orthogonal axes).\cite{chelikowsky} 
While these estimates seem to speak in favour of the real-space method,
we should consider that the TPA preconditioner\cite{tpa} used here for the 
cBiCG minimization cannot be simply adapted to real-space calculations,
hence in absence of appropriate preconditioners the planewave method
remains advantageous for essentially any relevant system size.

(iii) Another interesting option for improving our methodology is to
to drastically reduce the size of the basis set adopted. This could be achieved
for instance by adapting our implementation to electronic structure packages
exploiting local orbitals basis sets.\cite{siesta}
Interestingly the three possibilities here outlined are not mutually exclusive,
and probably an approrpiate combination of all of these would eventually open
the way to the study ofelectronic excitations within the $GW$ method in
very large systems.

In smmary, we proposed a new methodology for performing $GW$ calculations
using density-functional perturbation theory (DFPT-$GW$). We showed how
it is possible to calculate the screened Coulomb interaction and the non-interacting
Green's function without resorting to unoccupied electronic states.
We successfully demonstrated our method within a planewaves empirical
pseudopotential implementation and compared with previous literature for the
prototypical case of silicon. In our method the standard plasmon-pole
approximation for the frequency dependence of teh screened Coulomb interaction
has been replaced by a direct calculation along the imaginary frequency axis,
followed by an analytic continuation to the real axis through Pad\'e approximants.
In addition, we introduced the use of multishift linear system solvers for the simultaneous
calculation of multiple frequency responses at the cost of one single
iterative minimization.

It is our plan to adapt the present approach to deal with first-principles
pseudopotentials, and to explore the preformance of our procedure in a local
orbital implementation. We hope that this work will stimulate further efforts
towards improved methodologies for excited states calculations in large systems.

\begin{acknowledgments}
F.G. is grateful to Manish Jain for drawing Ref.\ \onlinecite{alavi} to his attention.
Computational resources were provided by the Oxford Supercomputing Centre.
This work was partly supported by the National Science Foundation Grant No. DMR04-39768 and by
the Director, Office of Science, Office of Basic Energy Sciences, Materials Sciences
and Engineering Division, U.\ S.\ Department of Energy under Contract No. DE-AC02-05CH11231.
\end{acknowledgments}

\appendix

\section{Condition number of the linear system}\label{app.condition}

\subsubsection{Screened Coulomb interaction}

The iterative calculation of the screened Coulomb interaction through 
Eq.\ (\ref{eq.linsys.1}) at finite real
frequencies $\w$ can be considerably more time-consuming than in the static
($\w\!=\!0$) case. Simple tests indicate that 
the number of iterations required to reach convergence increases with 
increasing frequency $\w$. This behavior suggests that the linear operator in
Eq.\ (\ref{eq.linsys.1}) becomes progressively more ill-conditioned 
as the frequency $\w$ increases.

In order to rationalize this observation, we here examine
the condition number of the linear operator $\H-\E_v\pm\w$ in Eq.\ (\ref{eq.linsys.1}).
The minimum number of iterations $N_{\rm min}$ required for the solution of
a linear system using the conjugate gradients algorithm is given by
  \begin{equation}\label{eq.cg}
  N_{\rm min} = \frac{1}{2}\sqrt{\kappa} \log(2/\varepsilon),
  \end{equation}
$\kappa$ being the condition number of the linear operator and $\varepsilon$ the
desired relative accuracy.\cite{painless.cg} In our calculations we adopt the 
complex biorthogonal variant (cBiCG) of the conjugate gradient method (CG)
following Ref.\ \onlinecite{jacobs}. This method is an extension of the standard 
conjugate gradients algorithm to the 
case of general complex matrices. While the estimate Eq.\ (\ref{eq.cg}) has
been derived for the original CG algorithm, we found empirically that it also 
provides a reasonable description of the convergence rate of the complex cBiCG version.
%
The condition number of a linear operator $\hat{A}$ can be calculated as the ratio 
of its largest $A_{\rm max}$ to smallest $A_{\rm min}$ eigenvalues: 
$\kappa=|A_{\rm max}/A_{\rm min}|$.
%If we formally expand the one-particle Hamiltonian $\H$ in terms of its valence 
%$|v\>$ and conduction $|c\>$ eigenstates, with eigenvalues $\E_v$ and $\E_c$, we obtain
%$\H = \sum_v \E_v |v\>\<v| + \sum_c \E_c |c\>\<c|$. 
For a given valence state 
$|v^\prime\>$ the linear operator $\hat{A}_\vp (\w) = \H - \E_\vp + \alpha \P - \w$ 
in Eq.\ (\ref{eq.linsys.1b}) has eigenvalues
%  \begin{equation}
%  \hat{A}_\vp (\w)  = 
%  \sum_v ( \E_v - \E_\vp + \alpha - w ) |v\>\<v| 
%  + \sum_c ( \E_c - \E_\vp - \w ) |c\>\<c|,
%  \end{equation}
$A_v = \E_v - \E_\vp + \alpha - \w$ and $A_c = \E_c - \E_\vp - \w$. 

Let consider first the simplest case where $\w=0$ and $\alpha>0$. In this case 
we find by inspection that the smallest eigenvalue is $|A_{\rm min}|= \min(E_{\rm g}, |\alpha-W_{\rm occ}|)$, 
$E_{\rm g}$ being the fundamental energy gap and $W_{\rm occ}$ the valence bandwidth.
It is common practice to set $\alpha=2W_{\rm occ}$ in order to avoid null eigenvalues.
\cite{baroni.rmp} With this choice the smallest eigenvalue becomes $|A_{\rm min}|=E_{\rm g}$.
On the other hand, the largest eigenvalue can be approximated by the
cutoff energy of the wavefunction basis set $|A_{\rm max}|=E_{\rm cut}$.
In this case the condition number reads $\kappa = E_{\rm cut}/E_{\rm g}$.
As an example, if we are using a plane-waves basis with a kinetic enegry
cutoff of 30 Ry, we have an electron energy gap of 1 eV, 
and the our desired accuracy is $\varepsilon=10^{-10}$, then according to
Eq.\ (\ref{eq.cg}) the minimum number of iterations required to solve 
the linear system would be $N_{\rm min} = 240$. Empirical tests show that 
this estimate is quite accurate for the system considered in the present work.
In order to improve the convergence rate it is useful to employ preconditioning
techniques. We here adopt the Teter-Payne-Allan preconditioner\cite{tpa}
in order to ``compress'' the eigenvalue spectrum and thereby reduce the
condition number. An ideal preconditioner would make the linear operator
almost perfectly well conditioned ($\kappa=1$). In this case
the optimal  number of iterations (for a relative accuracy $\varepsilon=10^{-10}$) 
would be as small as $N_{\rm min,pc} = 12$. We have found empirically
that by using the Teter-Payne-Allan 
preconditioner the number of iterations
required to achieve convergence was in all cases in the range $N_{\rm TPA}=$15--40. 

We now consider the case of $\w<0$. Simple algebra shows that in this case
$\kappa = E_{\rm cut}/(E_{\rm g} + w)$
when $\alpha = 2W_{\rm occ}$. Hence in this case the larger the frequency $\w$,
the better conditioned the linear system. We checked this result
by explicit calculations.

The worst case in terms of condition number is found when $\w>0$. 
In fact, as soon as the frequency exceeds the optical excitation
threshold $\w>E_{\rm g}$, the linear operator acquires null eigenvalues 
corresponding to the resonance condition $\w = \E_c - \E_\vp$. 
In this latter case the condition
number $\kappa(\w)$ exhibits significant structure, reflecting
the joint density of states of the system. Even after preconditioning the system, 
the number of iterations required to achieve convergence can be as high as 
$N_{\rm min} = 500$, thus rendering this avenue unpractical.
The calculation of the screened Coulomb interaction for frequencies slightly
off the real axis $\w+i\eta$, with $\w>0$ and small $\eta$, leads only to a negligible
improvement of the convergence rate.

The difficulty of solving iteratively the linear system Eq.\ (\ref{eq.linsys.1})
for large positive frequencies is accompanied by the additional difficulty 
of adequately sampling the Brillouin zone to describe the singularities at $\w = \E_c - \E_\vp$.

Alltogether, these considerations suggest that an iterative solution of the
linear system along the real axis is not convenient from the computational
viewpoint. For this reason we decided to evaluate $W_{\G,\Gp}(\q,\w)$
along the {\it imaginary axis} and then to analitically continue the functions
to the real axis using {\it Pad\'e approximants}.\cite{pade1,pade2,blochl}
The motivation behind our choice becomes obvious after considering a simple
plasmon-pole model of the screened Coulomb interaction (without loss of
generality):\cite{hl86}
  \begin{equation}
  W(\w) = v + \frac{W_0 -v}{2} \Big[ \frac{\w_{\rm p}}{\w+\w_{\rm p}} - \frac{\w_{\rm p}}{\w-\w_{\rm p}} \Big],
  \end{equation}
where $\w_{\rm p}$ is the pole frequency and $W_0$ the static screened Coulomb interation.
Analytical continuation of this function to the imaginary axis yields
  \begin{equation} \label{eq.pp.im}
  W(\w=i\beta) = v + \frac{W_0 -v}{1+(\beta/\w_{\rm p})^2}.
  \end{equation}
Equation (\ref{eq.pp.im}) indicates that the screened Coulomb interaction along the imaginary axis contains the same
amount of information as the one on the real axis ($\w_{\rm p}$ and $W_0$), and at the same time
does not show any singularities. In this case the condition number reads
(assuming no preconditioning and $\alpha=0$ for simplicity) 
$\kappa=[(E_{\rm g}^2+\beta^2)/(E_{\rm cut}^2+\beta^2)]^\frac{1}{2}$,
and tends to unity for large imaginary frequencies.
As a result, the worst case scenario for the solution 
of the linear system corresponds to the static case $W_{\G,\Gp}(\q,\w=0)$.

In summary, by solving iteratively the linear system along the imaginary
axis we circumvent the difficulties associated with the ill-conditioning
of the linear system Eq.\ (\ref{eq.linsys.1}) occurring at real frequencies
and the necessity of dense Brillouin zone sampling.
The details of the analytic continuation are discussed in Appendix \ref{app.pade}.

\subsubsection{Green's function}

A similar analysis can be carried out for the calculation of the Green's
function using the method introduced in Sec.\ \ref{sec.green}.
It is straightforward to establish that in this case the condition number
of the system is given by $\kappa = E_{\rm cut}/\delta$.
As the infinitesimal $\delta$ is typically taken to be 0.1 eV, we are effectively
dealing with a situation analogous to a small-bandgap semiconductor.
The TPA preconditioner can be adopted in order to reduce the condition number
to $\kappa = E_{\rm kin}^{\rm VBM}/\delta$, where $E_{\rm kin}^{\rm VBM}$
is the expectation value of the kinetic energy of the highest occupied state
and is independent of the basis set cutoff. Numerical tests confirm that this 
is indeed a sensible strategy.

\section{Preconditioned complex biconjugate gradient method}\label{app.cbcg}

The cBiCG algorithm introduced in Ref.\ \onlinecite{jacobs} 
did not include preconditioning. In this appendix we describe 
the preconditioned version of the cBiCG algorithm which we derived 
following Ref.~\onlinecite{painless.cg}.
%
We are interested in solving the linear system
  \begin{equation}\label{eq.axeqb}
  Ax=b,
  \end{equation}
with A a complex linear operator (not necessarily Hermitian), $b$ a complex 
vector, and $x$ the unknown solution vector.
In the cBiCG algorithm of Ref.\ \onlinecite{jacobs} two sequences of residuals $r_n$ and
$\rt_n$ are generated in such a way that successive residuals 
are biorthogonal [i.e.\ $\<r_{n+1}|\rt_n\>=0$ and $\<\rt_{n+1}|r_n\>=0$].
At the same time two sequences of search directions 
$p_n$ and $\pt_n$ are generated in such a way that successive directions
are biconjugate [i.e.\ $\< A p_{n+1}|\pt_n \> =0$ and 
$\< A^\dagger \pt_{n+1}|p_n \> =0$].
The algorithm starts by setting the initial residuals to
$r_0 = b-Ax_0$ ($x_0$ being the initial guess for the solution vector $x$) 
and $\rt_0=r_0^\star$, and the initial search directions to $p_0=r_0$ 
and $\pt_0=p_0^\star$. Next the solution
vector, the search directions, and the residuals are updated at each
iteration as follows:
  \begin{eqnarray}
  \alpha_n & = & \<\rt_n|r_n\>/\<\pt_n|Ap_n\> \label{eq.cg1}  \\ 
  x_{n+1} & = & x_n + \alpha_n p_n \label{eq.cg2} \\ 
  r_{n+1} & = & r_n - \alpha_n Ap_n \label{eq.cg3} \\ 
  \rt_{n+1} & = & \rt_n - \alpha_n^\star A^\dagger \pt_n \label{eq.cg4}\\ 
  \beta_n & = & - \<A^\dagger\pt_n|r_{n+1}\>/\<\pt_n|Ap_n\> \label{eq.cg5}\\ 
  p_{n+1} & = & r_{n+1} + \beta_n p_n \label{eq.cg6}\\ 
  \pt_{n+1} & = & \rt_{n+1} + \beta_n^\star \label{eq.cg7} \pt_n. 
  \end{eqnarray}
The time-consuming step in this algorithm is the application of the operators
$A$ and $A^\dagger$ to the search directions $p_n$ and $\pt_n$. 
As there are two such operations per iteration, the computational complexity 
is twice that of the standard conjugate gradient algorithm.

Preconditioning can be achieved by left-multiplying the linear system 
in Eq.\ (\ref{eq.axeqb}) 
by $M^{-1}$: $M^{-1}Ax=M^{-1}b$. If we assume that the preconditioner $M$ can be 
written as $M=E^{\rm T}E$, then we can rewrite the system as follows:
  \begin{equation}
  E^{-1}AE^{-{\rm T}} E^{\rm T}x = E^{-1}b.
  \end{equation}
By defining $A^\prime=E^{-1}AE^{-{\rm T}}$, $x^\prime=E^{\rm T}x$, and $b^\prime=E^{-1}b$
we obtain the transformed system $A^\prime x^\prime=b^\prime$, for which the
standard cBiCG method applies.
While this procedure is formally correct, it is not convenient to explicitely
transform the linear operator.
It is convenient instead to rewrite the procedure in terms of
$A$, $b$, and $x$ by performing a few formal manipulations.
For this purpose we make the substitutions
$r^\prime = E^{-1}r$ and $p^\prime=E^{\rm T} p$. Some algebra leads straightforwardly
to the preconditioned version of the cBiCG algorithm:
  \begin{eqnarray}
  \alpha_n & = & \<\rt_n|M^{-1}r_n\>/\<\pt_n|Ap_n\>  \\
  x_{n+1} & = & x_n + \alpha_n p_n \\ 
  r_{n+1} & = & r_n - \alpha_n Ap_n \\ 
  \rt_{n+1} & = & \rt_n - \alpha_n^\star A^\dagger \pt_n \\ 
  \beta_n & = & - \<A^\dagger\pt_n|M^{-1}r_{n+1}\>/\<\pt_n|Ap_n\> \\ 
  p_{n+1} & = & M^{-1}r_{n+1} + \beta_n p_n \\ 
  \pt_{n+1} & = & M^{-1}\rt_{n+1} + \beta_n^\star \pt_n.
  \end{eqnarray}
The preconditioned  cBiCG algorithm needs to be intialized with
$r_0=b-Ax_0$, $p_0=M^{-1}r_0$, $\rt_0=r_0^\star$, and $\pt_0=p_0^\star$.
In this work we have used the Teter-Payne-Allan function as the preconditioner 
$M^{-1}$.\cite{tpa}

\section{Analytic continuation using Pad\'e approximants}\label{app.pade}

In order to perform the analytic continuation of the screened Coulomb interaction
from the imaginary axis to the real axis in the complex frequency plane, we employ diagonal 
Pad\'e approximants.\cite{pade1,pade2,blochl}
The Pad\'e approximant of order $N$ is the optimal rational approximation
to a target function $f(\w)$ known in $N$ distinct points 
$\{\w_n$,~$n=1,\cdots,N\}$. 
When $N$ is an odd integer the diagonal Pad\'e approximant reads
  \begin{equation}
  P_N(\w) = \frac{p_0+p_1\w+\cdots+p_{(N-1)/2}\w^{(N-1)/2}}
  {1+q_1\w+\cdots+q_{(N-1)/2}\w^{(N-1)/2}},
  \end{equation}
and its coefficients $p_0, p_1, \cdots, p_{(N-1)/2}$, $q_1, \cdots, q_{(N-1)/2}$ are determined by matching the approximant
to the target function in $N$ points $P_N(\w_n)=f(\w_n)$,~$n=1,\cdots,N$.
Both the coefficients and the Pad\'e approximant can be calculated
very efficiently using a simple recursive algorithm.\cite{pade2}
Some experimentation indicates that approximants of order $N\ge5$ are necessary
in order to reproduce a plasmon-pole spectral shape including a finite linewidth.
This observation can be rationalized by considering that a plasmon-pole
spectral function is completely defined by the values of the function at $\w=0$,
the location, strenght, and width of the pole, and the asymptotic value at $\w=+i\infty$.
Some of this information is redundant and can be obtained by using sum rules.\cite{hl86}
The parity of the screened Coulomb interaction can also be exploited to minimize
the number of input frequencies. 

The advantage of the Pad\'e approximant is that a more refined description
of the frequency-dependent screened Coulomb interaction can simply be achieved
by calculating additional points along the imaginary axis. In practice
we have found that, if we do not set any constraints for the spectral
shape of the Pad\'e approximant, $N=11$ provides a good representation of the frequency
dependence of the screened Coulomb interaction. This is in line with the finding 
of Ref.\ \onlinecite{blochl} (where the authors use $N=12$) relative to the
case of the $GW$ self-energy. 
%Figure \ref{fig.pade} illustrates the quality
%of the analytic continuation using Pad\'e approximants for a few test cases.

We also investigated the possibility of analytically continuing
the screened Coulomb interaction by using a multi-pole expansion
as suggested in Ref.\ \onlinecite{spacetime}. The multi-pole approach
seems a more natural choice, as it incorporates the non-analyticity
of the dielectric function. We tried one-, two-, and three-pole
expansions by determining the coefficients using the simplex 
method of Nelder and Mead.\cite{nelder-mead}
The single-pole approximation appears robust but the quality
of the real-axis continuation is poorer than what we obtained
by using Pad\'e approximants. Multi-pole approximations were found
to be unreliable due to their high sensitivity to the initial guesses 
for the coefficients.
Our experience therefore is that the multi-pole expansion is not an optimal 
choice for an automated procedure where the analytic continuation has to be
performed for every $\G$, $\Gp$, and $\q$ of the screened Coulomb 
interaction without manual intervention. Our present analysis supports the view 
already expressed in Ref.\ \onlinecite{blochl}.

\section{Simultaneous calculation of the susceptibility at multiple frequencies}\label{app.multishift}

The linear systems Eqs.\ (\ref{eq.linsys.1.nscf}) and (\ref{eq.green.3})
can be solved efficiently by using the ``multishift'' 
cBiCG method of Ref.~\onlinecite{frommer}.
Multishift methods exploit the knowledge gained during the iterative
solution of the {\it seed system} $Ax=b$ in order to determine the solutions 
of the {\it shifted system} $Ax+\w x=b$ with only a small computational overhead.
The rationale behind such method is that the seed system and the
shifted system share the same Krilov subspaces $\{b,Ab,A^2b,\cdots\}$,
therefore the residuals of the seed and of the shifted
systems can be taken to be collinear.\cite{frommer}

This multishift technique allows us to determine the
entire frequency-dependence of the dielectric matrix
by performing one single static calculation for each set of parameters $[\q$,$\G]$ in
Eq.\ (\ref{eq.linsys.4}).
For the seed system the algorithm is still given by Eqs.\ (\ref{eq.cg1})-(\ref{eq.cg7}).
For the shifted system we replace the calculation of the residuals
$r_{n,\w}$ and of the coefficients $\alpha_{n,\w}$, $\beta_{n,\w}$ corresponding
to the frequency $\w$ by the following relations:
  \begin{equation} \label{eq.shift.1}
  r_{n,\w}  =\frac{r_n}{\pi_{n,\w}};
  \hspace{0.2cm}
  \alpha_{n,\w}  =  \frac{\pi_{n,\w}}{\pi_{n+1,\w}}\alpha_n ;
  \hspace{0.2cm}
  \beta_{n,\w}  =  \Big(\frac{\pi_{n,\w}}{\pi_{n+1,\w}}\Big)^2\beta_n,
  \end{equation}
where the scaling factor $\pi_{n+1,\w}$ is calculated through the recurrence relation
  \begin{equation}\label{eq.shift.2}
  \pi_{n+1,\w} = (1+\w\alpha_n) \pi_{n,\w} + \frac{\alpha_n\beta_{n-1}}{\alpha_{n-1}}(\pi_{n,\w}-\pi_{n-1,\w}).
  \end{equation}
In order to obtain collinear residuals $r_n$ and $r_{n,\w}$ we need to
initialize the algorithm using $x_0=0$.

The use of Eqs.~(\ref{eq.shift.1}) and (\ref{eq.shift.2}) allows us to
skip the time-consuming operations involving the Hamiltonian in
Eqs.\ (\ref{eq.cg1}) and~(\ref{eq.cg5}).
This method is extremely convienient for determining the frequency-dependent
susceptibility for many frequencies at the cost of one single calculation.

We point out that this method still carries some drawbacks.
One limitation is that this method cannot be applied to the self-consistent
system of Eq.\ (\ref{eq.linsys.1}), because the know-term on the
right-hand side depends on the frequency $\w$ itself.
Therefore the use of the shifted cBiCG method is only possible
for {\it non self-consistent calculations of the dielectric matrix}
and requires explicit matrix inversions to determine the screened
Coulomb interaction.
This approach can be regarded as an improved version 
of the technique proposed in Ref.\ \onlinecite{reining-sternheimer}.

Another limitation is that the shifted cBiCG method
does not allow for the use of preconditioners. In fact
the preconditioned seed system $M^{-1}Ax=M^{-1}b$ and the preconditioned shifted system
$M^{-1}Ax+\w M^{-1}x=M^{-1}b$ do not share the same Krilov subspaces, 
hence the residuals cannot be taken to be collinear.\cite{simoncini} 
The practical consequence is that for systems with
large basis set energy cutoffs and small band gaps, the number of iterations
required to achieve convergence could impractical.

\begin{thebibliography}{99}

\bibitem{hedin1}
L. Hedin,
Phys.\ Rev.\ {\bf 139}, A796 (1965).

\bibitem{hl86}
M. Hybertsen and S. G. Louie,
Phys.\ Rev.\ B {\bf 34}, 5390 (1986).

\bibitem{onida}
G. Onida, L. Reining, R. W. Godby, R. Del Sole, and W. Andreoni, 
Phys.\ Rev.\ Lett.\ {\bf 75}, 818 (1995).

\bibitem{rolfing}
M. Rohlfing and S. G. Louie,
Phys.\ Rev.\ B {\bf 62}, 4927 (2000).

\bibitem{reining-review}
G. Onida, L. Reining, and A. Rubio,
Rev.\ Mod.\ Phys.\ {\bf 74}, 601 (2002).

\bibitem{catalin} 
C. D. Spataru, S. Ismail-Beigi, L. X. Benedict, and S. G. Louie,
Phys.\ Rev.\ Lett.\ {\bf 92}, 077402 (2004).

\bibitem{rubio} 
K. S. Thygesen1 and A. Rubio,
Phys.\ Rev.\ B {\bf 77}, 115333 (2008).

\bibitem{catalin-lw} 
C. D. Spataru, M. A. Cazalilla, A. Rubio, L. X. Benedict, P. M. Echenique, and S. G. Louie,
Phys.\ Rev.\ Lett.\ {\bf 87}, 246405 (2001).

\bibitem{cheolhwan}
C.-H. Park, F. Giustino, M. L. Cohen, and S. G. Louie,
Nano Lett.\ {\bf XX}, XXXX (2009).

\bibitem{bruneval-oxide}
M. Gatti, F. Bruneval, V. Olevano, and L. Reining,
Phys.\ Rev.\ Lett.\ {\bf 99} 266402 (2007).

\bibitem{rinke}
P. Rinke, A. Qteish, J. Neugebauer, C. Freysoldt, and M. Scheffler, 
New J.\ Phys.\ {\bf 7}, 126 (2005). 

\bibitem{schilfegarde}
M. van Schilfgaarde, T. Kotani, and S. Faleev,
Phys.\ Rev.\ Lett.\ {\bf 96}, 226402 (2006).

\bibitem{york}
A. Schindlmayr and R. W. Godby,
Phys.\ Rev.\ Lett.\ {\bf 80}, 1702 (1998).

\bibitem{spacetime}
H. N. Rojas, R. W. Godby, and R. J. Needs,
Phys.\ Rev.\ Lett.\ {\bf 74}, 1827 (1995).

\bibitem{blochl}
S. Lebegue, B. Arnaud, M. Alouani, and P. E. Bl\"ochl,
Phys.\ Rev.\ B {\bf 67}, 155208 (2003). 

\bibitem{hl}
L. Hedin and S. Lundqvist,
Effects of the electron-electron and the electron-phonon interaction in
the one-electron states of solids,
in {\it Solid State Physics}, ed. by F. Seitz, D. Turnbull, and
H. Ehrenreich, (Academic, New York, 1969), vol.\ 23, pag. 1.

\bibitem{gunnarsson}
F. Aryasetiawan and O. Gunnarsson,
Rep.\ Prog.\ Phys.\ {\bf 61}, 237 (1998). 

\bibitem{sohrab} 
M. L. Tiago, S. Ismail-Beigi, and S. G. Louie,
Phys.\ Rev.\ B {\bf 69}, 125212 (2004).

\bibitem{bruneval-gonze}
F. Bruneval and X. Gonze,
Phys.\ Rev.\ B {\bf 78} 085125 (2008).

\bibitem{reining-sternheimer}
L. Reining, G. Onida, and R. W. Godby, 
Phys.\ Rev.\ B {\bf 56} R4301 (1997).

\bibitem{umari1}
P. Umari, G. Stenuit, and S. Baroni,
Phys.\ Rev.\ B {\bf 79}, 201104(R) (2009).

\bibitem{umari2}
P. Umari, G. Stenuit and S. Baroni,
arXiv:0910.0791.

\bibitem{gygi}
H. F. Wilson, D. Lu, F. Gygi, and G. Galli,
Phys.\ Rev.\ B {\bf 79}, 245106 (2009).

\bibitem{baroni.rmp}
S. Baroni, S. de Gironcoli, A. Dal Corso, and P. Giannozi, 
Rev.\ Mod.\ Phys.\ {\bf 73}, 515 (2001).

\bibitem{frommer}
A. Frommer,
Computing {\bf 70}, 87 (2003).

\bibitem{cohen_berg}
M. L. Cohen and T. K. Bergstresser,
Phys.\ Rev.\ {\bf 141}, 789 (1966).

\bibitem{fleszar-resta}
A. Fleszar and R. Resta,
Phys.\ Rev.\ B {\bf 31}, 5305 (1985).

\bibitem{kunc-tosatti}
K. Kunc and E. Tosatti,
Phys.\ Rev.\ B {\bf 29}, 7045 (1984).

\bibitem{giannozzi}
S. Baroni, P. Giannozzi, and A. Testa,
Phys.\ Rev.\ Lett.\ {\bf 58}, 1861 (1987).

\bibitem{degironcoli}
S. de Gironcoli,
Phys.\ Rev.\ B {\bf 51}, 6773 (1995).

\bibitem{reining94}
R. Dal Sole, L. Reining, and R. W. Godby,
Phys.\ Rev.\ B {\bf 49}, 8024 (1994).

\bibitem{espresso}
P. Giannozzi {\it et al.},
% S. Baroni, N. Bonini, M. Calandra, R. Car, C. Cavazzoni, D. Ceresoli, G. L. Chiarotti, 
%M. Cococcioni, I. Dabo, A. Dal Corso, S. Fabris, G. Fratesi, S. de Gironcoli, R. Gebauer, 
%U. Gerstmann, C. Gougoussis, A. Kokalj, M. Lazzeri, L. Martin-Samos, N. Marzari, F. Mauri, 
%R. Mazzarello, S. Paolini, A. Pasquarello, L. Paulatto, C. Sbraccia, S. Scandolo, 
%G. Sclauzero, A. P. Seitsonen, A. Smogunov, P. Umari, R. M. Wentzcovitch, 
J.\ Phys.: Condens.\ Matter {\bf 21}, 395502 (2009).

\bibitem{cpm}
R. M. Pick, M. H. Cohen, and R. M. Martin,
Phys.\ Rev.\ B {\bf 1}, 910 (1970). 

\bibitem{hl86-prb}
M. S. Hybertsen and S. G. Louie,
Phys.\ Rev.\ B {\bf 35}, 5585 (1976).

\bibitem{balde_tosa}
A. Baldereschi and E. Tosatti,
Phys.\ Rev.\ B {\bf 17}, 4710 (1978).

\bibitem{baroni-resta}
S. Baroni and R. Resta,
Phys.\ Rev.\ B {\bf 33}, 7017 (1986).

\bibitem{alavi}
J. Spencer and A. Alavi.
Phys.\ Rev.\ B {\bf 77} 193110 (2008).

\bibitem{painless.cg}
G.\ H.\ Golub and C.\ F.\ Van Loan, {\it Matrix Computations} (John Hopkins University Press, Baltimore, 1983).

\bibitem{jacobs}
D.\ A.\ H.\ Jacobs,
IMA J.\ Numer.\ Anal.\ {\bf 6}, 446 (1986).

\bibitem{tpa}
M. P. Teter, M. C. Payne, and D. C. Allan,
Phys.\ Rev.\ B {\bf 40}, 12255 (1989).

\bibitem{pade1}
K.-H. Lee and K. J. Chang,
Phys.\ Rev.\ B {\bf 54}, R8285 (1996).

\bibitem{pade2}
H. J. Vidberg and J. W. Serene,
J.\ Low.\ Temp.\ Phys.\ {\bf 29}, 179 (1977).

\bibitem{nelder-mead}
J. A. Nelder and R. Mead,
Comput. J. {\bf 7}, 308 (1965).
%We used the implementation available from the
%{\tt E04CCF} routine of the {\tt NAG} library
%({\tt www.nag.co.uk}).

\bibitem{simoncini}
V. Simoncini and D. B. Szyld,
Numer.\ Linear Algebr.\ {\bf 14}, 1 (2006).

\bibitem{frigo}
S. G. Johnson and M. Frigo,
IEEE Trans.\ Sig.\ Proc.\ {\bf 55}, 111 (2007).

\bibitem{chelikowsky}
A. Natan, A. Benjamini, D. Naveh, L. Kronik, M. L. Tiago, S. P. Beckman, and J. R. Chelikowsky,
Phys.\ Rev.\ B {\bf 78}, 075109 (2008).

\bibitem{siesta}
J. M. Soler, E. Artacho, J. D. Gale, A. Garc\`ia, J. Junquera, P. Ordej\'on, and D. S\'anchez-Portal,
J.\ Phys.: Condens.\ Matter {\bf 14}, 2745 (2002).

\bibitem{cohen.diel1}
J. P. Walter and M. L. Cohen,
Phys.\ Rev.\ B {\bf 2}, 1821 (1970).

\bibitem{cohen.diel2}
J. P. Walter and M. L. Cohen,
Phys.\ Rev.\ B {\bf 5}, 3101 (1972).

\bibitem{ncpp}
D. R. Hamann, M. Schl\"uter, and C. Chiang,
Phys.\ Rev.\ Lett.\ {\bf 43}, 1494 (1979).

\bibitem{uspp}
D. Vanderbilt, 
Phys.\ Rev.\ B {\bf 32}, 8412 (1985).

\bibitem{appelbaum}
J. A. Appelbaum and D. R. Hamman, 
Phys.\ Rev.\ B {\bf 8}, 1777 (1973).

\bibitem{EPM-density}
J. R. Chelikowsky and M. L. Cohen,
Phys.\ Rev.\ B {\bf 10}, 5095 (1974).

\bibitem{gonze-variational}
X. Gonze,
Phys.\ Rev. B {\bf 55}, 10337 (1997).

\bibitem{r35}
{\it Numerical Data and Functional Relationships in Science and Technology}, 
edited by K. H. Hellwege and O. Madelung, Landolt-B\"ornstein, 
New Series, Group III, Vol. 17, pt. A and Vol. 22, pt. A (Springer, Berlin, 1982).

\bibitem{r39}
J. E. Ortega and F. J. Himpsel, 
Phys.\ Rev.\ B {\bf 47}, 2130 (1993).

\bibitem{johnson}
D. D. Johnson, 
Phys.\ Rev.\ B {\bf 38}, 12807 (1988).

\bibitem{lda1}
D. M. Ceperley and B. J. Alder,
Phys.\ Rev.\ Lett.\ {\bf 45}, 566 (1980).

\bibitem{lda2}
J. P. Perdew and A. Zunger,
Phys.\ Rev.\ B {\bf 23}, 5048 (1981).

\bibitem{carparrinello}
R. Car and M. Parrinello,
Phys.\ Rev.\ Lett.\ {\bf 55}, 2471 (1985). 

\end{thebibliography}

\end{document}
